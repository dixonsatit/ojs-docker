!function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t){window.Lens=t("./src/app")},{"./src/app":176}],2:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=t("substance-document"),i=function(t){t=i.prepareOptions(t),o.call(this,t),this.bySourceId=this.addIndex("by_source_id",{property:"source_id"}),this.nodeTypes=t.nodeTypes,void 0===t.seed&&(this.create({id:"document",type:"document",guid:t.id,creator:t.creator,created_at:t.created_at,views:i.views,title:"","abstract":"",authors:[]}),n.each(i.views,function(t){this.create({id:t,type:"view",nodes:[]})},this))};i.Prototype=function(){this.fromSnapshot=function(t,e){return i.fromSnapshot(t,e)},this.getNodeBySourceId=function(t){var e=this.bySourceId.get(t),n=Object.keys(e)[0],r=e[n];return r},this.getHeadings=function(){var t=n.filter(this.get("content").getNodes(),function(t){return"heading"===t.type});return t},this.getTocNodes=function(){var t=n.filter(this.get("content").getNodes(),function(t){return t.includeInToc()});return t}},i.prepareOptions=function(t){return t=t||{},t.nodeTypes=n.extend(i.nodeTypes,t.nodeTypes),t.schema=i.getSchema(t.nodeTypes),t},i.getSchema=function(t){var e=r.deepclone(o.schema);return e.id="lens-article",e.version="0.3.0",n.each(t,function(t,n){e.types[n]=t.Model.type}),e},i.fromSnapshot=function(t,e){return e=e||{},e.seed=t,new i(e)},i.views=["content","figures","citations","definitions","info"],i.nodeTypes=t("./nodes"),i.ViewFactory=t("./view_factory"),i.ResourceView=t("./resource_view");var s={id:"lens_article",nodes:{document:{type:"document",id:"document",views:["content"],title:"The Anatomy of a Lens Article",authors:["contributor_1","contributor_2","contributor_3"],guid:"lens_article"},content:{type:"view",id:"content",nodes:["cover"]},cover:{id:"cover",type:"cover"},contributor_1:{id:"contributor_1",type:"contributor",name:"Michael Aufreiter"},contributor_2:{id:"contributor_2",type:"contributor",name:"Ivan Grubisic"},contributor_3:{id:"contributor_3",type:"contributor",name:"Rebecca Close"}}};i.describe=function(){var t=new i({seed:s}),e=0;return n.each(i.nodeTypes,function(r){r=r.Model;var o="heading_"+r.type.id;t.create({id:o,type:"heading",content:r.description.name,level:1});var i=r.description.remarks.join(" "),s="text_"+r.type.id+"_intro";t.create({id:s,type:"text",content:i}),t.show("content",[o,s],-1),t.create({id:o+"_properties",type:"text",content:r.description.name+" uses the following properties:"}),t.show("content",[o+"_properties"],-1);var a=[];n.each(r.description.properties,function(n,r){var o="text_"+ ++e;t.create({id:o,type:"text",content:r+": "+n}),t.create({id:e+"_annotation",type:"code",path:[o,"content"],range:[0,r.length]}),a.push(o)}),t.create({id:o+"_property_list",type:"list",items:a,ordered:!1}),t.show("content",[o+"_property_list"],-1),t.create({id:o+"_example",type:"text",content:"Here's an example:"}),t.create({id:o+"_example_codeblock",type:"codeblock",content:JSON.stringify(r.example,null,"  ")}),t.show("content",[o+"_example",o+"_example_codeblock"],-1)}),t},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,Object.defineProperties(i.prototype,{id:{get:function(){return this.get("document").guid},set:function(t){this.get("document").guid=t}},creator:{get:function(){return this.get("document").creator},set:function(t){this.get("document").creator=t}},created_at:{get:function(){return this.get("document").created_at},set:function(t){this.get("document").created_at=t}},title:{get:function(){return this.get("document").title},set:function(t){this.get("document").title=t}},"abstract":{get:function(){return this.get("document").abstract},set:function(t){this.get("document").abstract=t}},on_behalf_of:{get:function(){return this.get("document").on_behalf_of},set:function(t){this.get("document").on_behalf_of=t}},authors:{get:function(){var t=this.get("document");return t.authors?n.map(t.authors,function(t){return this.get(t)},this):""},set:function(t){var e=this.get("document");e.authors=n.clone(t)}},views:{get:function(){return this.get("document").views.slice(0)}}}),e.exports=i},{"./nodes":73,"./resource_view":117,"./view_factory":118,"substance-document":160,"substance-util":167,underscore:175}],3:[function(t,e){var n={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},r={};r.formatDate=function(t){var e=t.split("-");if(e.length>=3){var r=new Date(e[0],e[1]-1,e[2]);return r.toUTCString().slice(0,16)}if(2===e.length){var o=e[1].replace(/^0/,""),i=e[0];return n[o]+" "+i}return i},e.exports=r},{}],4:[function(t,e){"use strict";var n=t("./article");e.exports=n},{"./article":2}],5:[function(t,e){"use strict";var n=t("substance-document"),r=function(t,e){n.Node.call(this,t,e)};r.type={id:"affiliation",parent:"content",properties:{source_id:"string",city:"string",country:"string",department:"string",institution:"string",label:"string"}},r.description={name:"Affiliation",description:"Person affiliation",remarks:["Name of a institution or organization, such as a university or corporation, that is the affiliation for a contributor such as an author or an editor."],properties:{institution:"Name of institution",department:"Department name",country:"Country where institution is located",city:"City of institution",label:"Affilation label. Usually a number counting up"}},r.example={id:"affiliation_1",source_id:"aff1",city:"Jena",country:"Germany",department:"Department of Molecular Ecology",institution:"Max Planck Institute for Chemical Ecology",label:"1",type:"affiliation"},r.Prototype=function(){},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],6:[function(t,e){"use strict";e.exports={Model:t("./affiliation")}},{"./affiliation":5}],7:[function(t,e){var n=t("substance-document"),r=function(t,e){n.Node.call(this,t,e)};r.type={id:"annotation",properties:{path:["array","string"],range:["array","number"]}},r.Prototype=function(){this.getLevel=function(){return this.constructor.fragmentation}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.NEVER=1,r.OK=2,r.DONT_CARE=3,r.fragmentation=r.DONT_CARE,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],8:[function(t,e){"use strict";var n=function(t,e){this.node=t,this.viewFactory=e,this.el=this.createElement(),this.el.dataset.id=t.id,this.$el=$(this.el),this.setClasses()};n.Prototype=function(){this.createElement=function(){return document.createElement("span")},this.setClasses=function(){this.$el.addClass("annotation").addClass(this.node.type)},this.render=function(){return this}},n.prototype=new n.Prototype,e.exports=n},{}],9:[function(t,e){e.exports={Model:t("./annotation.js"),View:t("./annotation_view.js")}},{"./annotation.js":7,"./annotation_view.js":8}],10:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=function(t,e){r.call(this,t,e)};o.type={id:"emphasis",parent:"annotation",properties:{style:"string"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.DONT_CARE,n.Node.defineProperties(o),e.exports=o},{"../annotation/annotation":7,"substance-document":160}],11:[function(t,e){var n=t("../annotation").View,r=function(t){n.call(this,t)};r.Prototype=function(){this.setClasses=function(){n.prototype.setClasses.call(this),this.$el.addClass(this.node.style)}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../annotation":9}],12:[function(t,e){e.exports={Model:t("./author_callout.js"),View:t("./author_callout_view.js")}},{"./author_callout.js":10,"./author_callout_view.js":11}],13:[function(t,e){"use strict";var n=t("substance-document"),r=n.Composite,o=function(t,e){r.call(this,t,e)};o.type={id:"box",parent:"content",properties:{source_id:"string",label:"string",children:["array","paragraph"]}},o.description={name:"Box",remarks:["A box type."],properties:{label:"string",children:"0..n Paragraph nodes"}},o.example={id:"box_1",type:"box",label:"Box 1",children:["paragraph_1","paragraph_2"]},o.Prototype=function(){this.getChildrenIds=function(){return this.properties.children}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,n.Node.defineProperties(o),e.exports=o},{"substance-document":160}],14:[function(t,e){"use strict";var n=t("../node").View,r=t("../composite").View,o=t("substance-application").$$,i=function(t,e){r.call(this,t,e)};i.Prototype=function(){this.render=function(){if(n.prototype.render.call(this),this.node.label){var t=o(".label",{text:this.node.label});this.content.appendChild(t)}return this.renderChildren(),this.el.appendChild(this.content),this}},i.Prototype.prototype=r.prototype,i.prototype=new i.Prototype,e.exports=i},{"../composite":30,"../node":85,"substance-application":149}],15:[function(t,e){"use strict";e.exports={Model:t("./box"),View:t("./box_view")}},{"./box":13,"./box_view":14}],16:[function(t,e){"use strict";var n=t("substance-document"),r=function(t,e){n.Composite.call(this,t,e)};r.type={id:"caption",parent:"content",properties:{source_id:"string",title:"paragraph",children:["array","paragraph"]}},r.description={name:"Caption",remarks:["Container element for the textual description that is associated with a Figure, Table, Video node etc.","This is the title for the figure or the description of the figure that prints or displays with the figure."],properties:{title:"Caption title (optional)",children:"0..n Paragraph nodes"}},r.example={id:"caption_1",children:["paragraph_1","paragraph_2"]},r.Prototype=function(){this.getChildrenIds=function(){return this.properties.children||[]},this.hasTitle=function(){return!!this.properties.title},this.getTitle=function(){return this.properties.title?this.document.get(this.properties.title):void 0}},r.Prototype.prototype=n.Composite.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],17:[function(t,e){"use strict";var n=t("../composite").View,r=t("substance-application").$$,o=function(t,e){n.call(this,t,e)};o.Prototype=function(){this.render=function(){this.content=r("div.content");var t=this.node.getTitle();if(t){var e=this.createChildView(this.node.title),n=e.render().el;n.classList.add("caption-title"),this.content.appendChild(n)}return this.renderChildren(),this.el.appendChild(this.content),this}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"../composite":30,"substance-application":149}],18:[function(t,e){"use strict";e.exports={Model:t("./caption"),View:t("./caption_view")}},{"./caption":16,"./caption_view":17}],19:[function(t,e){var n=t("underscore"),r=t("substance-document"),o=function(t,e){r.Node.call(this,t,e)};o.type={id:"article_citation",parent:"content",properties:{source_id:"string",title:"string",label:"string",authors:["array","string"],doi:"string",source:"string",volume:"string",citation_type:"string",publisher_name:"string",publisher_location:"string",fpage:"string",lpage:"string",year:"string",comment:"string",citation_urls:["array","object"]}},o.description={name:"Citation",remarks:["A journal citation.","This element can be used to describe all kinds of citations."],properties:{title:"The article's title",label:"Optional label (could be a number for instance)",doi:"DOI reference",source:"Usually the journal name",volume:"Issue number",citation_type:"Citation Type",publisher_name:"Publisher Name",publisher_location:"Publisher Location",fpage:"First page",lpage:"Last page",year:"The year of publication",comment:"Author comment.",citation_urls:"A list of links for accessing the article on the web"}},o.example={id:"article_nature08160",type:"article_citation",label:"5",title:"The genome of the blood fluke Schistosoma mansoni",authors:["M Berriman","BJ Haas","PT LoVerde"],citation_type:"Journal Article",doi:"http://dx.doi.org/10.1038/nature08160",source:"Nature",volume:"460",fpage:"352",lpage:"8",year:"1984",comment:"This is a comment.",citation_urls:[{name:"PubMed",url:"http://www.ncbi.nlm.nih.gov/pubmed/19606141"}]},o.Prototype=function(){this.urls=function(){return this.properties.citation_urls.length>0?this.properties.citation_urls:[this.properties.doi]},this.getHeader=function(){return n.compact([this.properties.label,this.properties.citation_type||"Citation"]).join(" - ")}},o.Prototype.prototype=r.Node.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,r.Node.defineProperties(o),e.exports=o},{"substance-document":160,underscore:175}],20:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").$$,o=t("../node").View,i=t("../../resource_view"),s=function(t,e,n){o.apply(this,arguments),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){var t=document.createDocumentFragment(),e=this.node,o=this.createTextPropertyView([e.id,"title"],{classes:"title"});t.appendChild(o.render().el),t.appendChild(r(".authors",{html:e.authors.join(", ")}));var i="",s="",a="",c="";e.source&&""===e.volume?s=e.source:e.source&&e.volume&&(s=[e.source,e.volume].join(", ")),e.fpage&&e.lpage&&(a=[e.fpage,e.lpage].join("-"));var u=[];if(e.publisher_name&&e.publisher_location&&(u.push(e.publisher_name),u.push(e.publisher_location)),e.year&&u.push(e.year),c=u.join(", "),i=s,s&&(a||c)&&(i+=": "),a&&c?i+=[a,c].join(", "):(i+=a,i+=c),t.appendChild(r(".source",{html:i})),e.comment){var l=this.createTextView({path:[e.id,"comment"],classes:"comment"});t.appendChild(l.render().el)}e.doi&&t.appendChild(r(".doi",{children:[r("b",{text:"DOI: "}),r("a",{href:e.doi,target:"_new",text:e.doi})]}));var p=r(".citation-urls");n.each(e.citation_urls,function(t){p.appendChild(r("a.url",{href:t.url,text:t.name,target:"_blank"}))}),t.appendChild(p),this.content.appendChild(t)}},s.Prototype.prototype=o.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,e.exports=s},{"../../resource_view":117,"../node":85,"substance-application":149,underscore:175}],21:[function(t,e){"use strict";e.exports={Model:t("./citation"),View:t("./citation_view")}},{"./citation":19,"./citation_view":20}],22:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=t("../resource_reference/resource_reference"),i=function(t,e){o.call(this,t,e)};i.type={id:"citation_reference",parent:"resource_reference",properties:{target:"citation"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),e.exports=i},{"../annotation/annotation":7,"../resource_reference/resource_reference":95,"substance-document":160}],23:[function(t,e){e.exports={Model:t("./citation_reference.js"),View:t("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":96,"./citation_reference.js":22}],24:[function(t,e){var n=t("../annotation/annotation"),r=function(t,e){n.call(this,t,e)};r.type={id:"underline",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,e.exports=r},{"../annotation/annotation":7}],25:[function(t,e){e.exports={Model:t("./code.js"),View:t("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":8,"./code.js":24}],26:[function(t,e){"use strict";var n=t("../text").Model,r=function(t,e){n.call(this,t,e)};r.type={id:"codeblock",parent:"content",properties:{source_id:"string",content:"string"}},r.config={zoomable:!0},r.description={name:"Codeblock",remarks:["Text in a codeblock is displayed in a fixed-width font, and it preserves both spaces and line breaks"],properties:{content:"Content"}},r.example={type:"codeblock",id:"codeblock_1",content:'var text = "Sun";\nvar op1 = null;\ntext = op2.apply(op1.apply(text));\nconsole.log(text);'},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,e.exports=r},{"../text":106}],27:[function(t,e){"use strict";var n=t("../text/text_view"),r=function(t){n.call(this,t)};r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../text/text_view":109}],28:[function(t,e){"use strict";e.exports={Model:t("./codeblock"),View:t("./codeblock_view")}},{"./codeblock":26,"./codeblock_view":27}],29:[function(t,e){"use strict";var n=t("../node").View,r=function(t,e){n.call(this,t,e),this.childrenViews=[]};r.Prototype=function(){this.render=function(){return n.prototype.render.call(this),this.renderChildren(),this},this.renderChildren=function(){for(var t=this.node.getChildrenIds(),e=0;e<t.length;e++){var n=this.createChildView(t[e]),r=n.render().el;this.content.appendChild(r)}},this.dispose=function(){n.prototype.dispose.call(this);for(var t=0;t<this.childrenViews.length;t++)this.childrenViews[t].dispose()},this.delete=function(){},this.getCharPosition=function(){return 0},this.getDOMPosition=function(){var t=this.$(".content")[0],e=document.createRange();return e.setStartBefore(t.childNodes[0]),e},this.createChildView=function(t){var e=this.createView(t);return this.childrenViews.push(e),e}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../node":85}],30:[function(t,e){"use strict";var n=t("substance-document");e.exports={Model:n.Composite,View:t("./composite_view")}},{"./composite_view":29,"substance-document":160}],31:[function(t,e){var n=t("underscore"),r=t("substance-document"),o=function(t,e){r.Node.call(this,t,e)};o.type={id:"contributor",parent:"content",properties:{source_id:"string",name:"string",role:"string",contributor_type:"string",affiliations:["array","affiliation"],present_address:["string"],fundings:["array","string"],image:"string",emails:["array","string"],contribution:"string",bio:["array","paragraph"],deceased:"boolean",members:["array","string"],orcid:"string",equal_contrib:["array","string"],competing_interests:["array","string"]}},o.description={name:"Contributor",remarks:["A contributor entity."],properties:{name:"Full name",affiliations:"A list of affiliation ids",present_address:"Present address of the contributor",role:"Role of contributor (e.g. Author, Editor)",fundings:"A list of funding descriptions",deceased:!1,emails:"A list of emails",orcid:"ORCID",contribution:"Description of contribution",equal_contrib:"A list of people who contributed equally",competing_interests:"A list of conflicts",members:"a list of group members"}},o.example={id:"person_1",type:"contributor",name:"John Doe",affiliations:["affiliation_1","affiliation_2"],role:"Author",fundings:["Funding Organisation 1"],emails:["a@b.com"],contribution:"Revising the article, data cleanup",equal_contrib:["John Doe","Jane Doe"]},o.Prototype=function(){this.getAffiliations=function(){return n.map(this.properties.affiliations,function(t){return this.document.get(t)},this)},this.getHeader=function(){return this.properties.contributor_type||"Author"}},o.Prototype.prototype=r.Node.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,r.Node.defineProperties(o),e.exports=o},{"substance-document":160,underscore:175}],32:[function(t,e){"use strict";var n=t("underscore"),r=t("../node").View,o=t("substance-application").$$,i=t("../../resource_view"),s=function(t,e,n){r.call(this,t,e),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){if(this.content.appendChild(o(".contributor-name",{text:this.node.name})),this.node.role&&this.content.appendChild(o(".role",{text:this.node.role})),this.content.appendChild(o(".affiliations",{children:n.map(this.node.getAffiliations(),function(t){var e=n.compact([t.department,t.institution,t.city,t.country]).join(", ");return o(".affiliation",{text:e})})})),this.node.present_address&&(this.content.appendChild(o(".label",{text:"Present address"})),this.content.appendChild(o(".contribution",{text:this.node.present_address}))),this.node.contribution&&(this.content.appendChild(o(".label",{text:"Contribution"})),this.content.appendChild(o(".contribution",{text:this.node.contribution}))),this.node.equal_contrib&&this.node.equal_contrib.length>0&&(this.content.appendChild(o(".label",{text:"Contributed equally with"})),this.content.appendChild(o(".equal-contribution",{text:this.node.equal_contrib}))),this.node.emails.length>0&&(this.content.appendChild(o(".label",{text:"For correspondence"})),this.content.appendChild(o(".emails",{children:n.map(this.node.emails,function(t){return o("a",{href:"mailto:"+t,text:t})})}))),this.node.fundings.length>0&&(this.content.appendChild(o(".label",{text:"Funding"})),this.content.appendChild(o(".fundings",{children:n.map(this.node.fundings,function(t){return o(".funding",{text:t})})}))),this.node.competing_interests.length>0&&(this.content.appendChild(o(".label",{text:"Competing Interests"})),this.content.appendChild(o(".competing-interests",{children:n.map(this.node.competing_interests,function(t){return o(".conflict",{text:t})})}))),this.node.orcid&&(this.content.appendChild(o(".label",{text:"ORCID"})),this.content.appendChild(o("a.orcid",{href:this.node.orcid,text:this.node.orcid}))),this.node.members.length>0&&(this.content.appendChild(o(".label",{text:"Group Members"})),this.content.appendChild(o(".members",{children:n.map(this.node.members,function(t){return o(".member",{text:t})})}))),this.node.image||this.node.bio&&this.node.bio.length>0){var t=o(".bio"),e=[o("img",{src:this.node.image}),t];n.each(this.node.bio,function(e){t.appendChild(this.createView(e).render().el)},this),this.content.appendChild(o(".contributor-bio.container",{children:e}))}this.node.deceased&&this.content.appendChild(o(".label",{text:"* Deceased"}))}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"../../resource_view":117,"../node":85,"substance-application":149,underscore:175}],33:[function(t,e){"use strict";e.exports={Model:t("./contributor"),View:t("./contributor_view")}},{"./contributor":31,"./contributor_view":32}],34:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=t("../resource_reference/resource_reference"),i=function(t,e){o.call(this,t,e)};i.type={id:"contributor_reference",parent:"resource_reference",properties:{target:"contributor"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),e.exports=i},{"../annotation/annotation":7,"../resource_reference/resource_reference":95,"substance-document":160}],35:[function(t,e){e.exports={Model:t("./contributor_reference.js"),View:t("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":96,"./contributor_reference.js":34}],36:[function(t,e){var n=t("underscore"),r=t("substance-document"),o=function(t,e){r.Node.call(this,t,e)};o.type={id:"cover",parent:"content",properties:{source_id:"string",authors:["array","paragraph"],breadcrumbs:"object"}},o.description={name:"Cover",remarks:["Virtual view on the title and authors of the paper."],properties:{authors:"A paragraph that has the authors names plus references to the person cards"}},o.example={id:"cover",type:"cover"},o.Prototype=function(){this.getAuthors=function(){return n.map(this.properties.authors,function(t){return this.document.get(t)},this)},this.getTitle=function(){return this.document.title}},o.Prototype.prototype=r.Node.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,r.Node.defineProperties(o),e.exports=o},{"substance-document":160,underscore:175}],37:[function(t,e){"use strict";var n=t("underscore"),r=t("../node").View,o=t("substance-application").$$,i=t("../../article_util"),s=function(t,e){r.call(this,t,e)};s.Prototype=function(){this.render=function(){r.prototype.render.call(this);var t=this.node,e=this.node.document.get("publication_info");if(t.breadcrumbs&&t.breadcrumbs.length>0){var s=o(".breadcrumbs",{children:n.map(t.breadcrumbs,function(t){var e;return e=t.image?'<img src="'+t.image+'" title="'+t.name+'"/>':t.name,o("a",{href:t.url,html:e})})});this.content.appendChild(s)}if(e){var a=e.published_on;if(a){var c=[i.formatDate(a)];e.journal&&!t.breadcrumbs&&c.push(" in <i>"+e.journal+"</i>"),this.content.appendChild(o(".published-on",{html:c.join("")}))}}var u=this.createTextPropertyView(["document","title"],{classes:"title"});this.content.appendChild(u.render().el);var l=o(".authors",{children:n.map(t.getAuthors(),function(t){var e=this.viewFactory.createView(t),n=e.render().el;return this.content.appendChild(n),n},this)});if(l.appendChild(o(".content-node.text.plain",{children:[o(".content",{text:this.node.document.on_behalf_of})]})),this.content.appendChild(l),e&&e.links.length>0){var p=o(".links");n.each(e.links,function(t){if("json"===t.type&&""===t.url){var e=JSON.stringify(this.node.document.toJSON(),null,"  "),n=new Blob([e],{type:"application/json"});p.appendChild(o("a.json",{href:window.URL?window.URL.createObjectURL(n):"#",html:'<i class="fa fa-external-link-square"></i> '+t.name,target:"_blank"}))}else p.appendChild(o("a."+t.type,{href:t.url,html:'<i class="fa fa-external-link-square"></i> '+t.name,target:"_blank"}))},this),this.content.appendChild(p)}if(e){var h=e.doi;h&&this.content.appendChild(o(".doi",{html:'DOI: <a href="http://dx.doi.org/'+h+'">'+h+"</a>"}))}return this}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"../../article_util":3,"../node":85,"substance-application":149,underscore:175}],38:[function(t,e){"use strict";e.exports={Model:t("./cover"),View:t("./cover_view")}},{"./cover":36,"./cover_view":37}],39:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=function(t,e){r.call(this,t,e)};o.type={id:"cross_reference",parent:"annotation",properties:{target:"node"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),e.exports=o},{"../annotation/annotation":7,"substance-document":160}],40:[function(t,e){e.exports={Model:t("./cross_reference.js"),View:t("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":96,"./cross_reference.js":39}],41:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=function(t,e){r.call(this,t,e)};o.type={id:"custom_annotation",parent:"annotation",properties:{name:"string"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.DONT_CARE,n.Node.defineProperties(o),e.exports=o},{"../annotation/annotation":7,"substance-document":160}],42:[function(t,e){var n=t("../annotation").View,r=function(t){n.call(this,t)};r.Prototype=function(){this.setClasses=function(){n.prototype.setClasses.call(this),this.$el.addClass(this.node.name)}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../annotation":9}],43:[function(t,e){e.exports={Model:t("./custom_annotation.js"),View:t("./custom_annotation_view.js")}},{"./custom_annotation.js":41,"./custom_annotation_view.js":42}],44:[function(t,e){var n=t("substance-document"),r=function(t){n.Node.call(this,t)};r.type={id:"definition",parent:"content",properties:{source_id:"string",title:"string",description:"string"}},r.description={name:"Definition",remarks:["A journal citation.","This element can be used to describe all kinds of citations."],properties:{title:"The article's title",description:"Definition description"}},r.example={id:"definition_def1",type:"Definition",title:"IAP",description:"Integrated Analysis Platform"},r.Prototype=function(){this.urls=function(){return this.properties.citation_urls.length>0?this.properties.citation_urls:[this.properties.doi]},this.getHeader=function(){return this.properties.label?[this.properties.label,this.properties.title].join(". "):this.properties.title}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],45:[function(t,e){"use strict";var n=t("underscore"),r=t("../node").View,o=t("substance-application").$$,i=t("../../resource_view"),s=function(t,e,n){r.call(this,t,e),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){this.content.appendChild(o(".description",{text:this.node.description}))}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,e.exports=s},{"../../resource_view":117,"../node":85,"substance-application":149,underscore:175}],46:[function(t,e){"use strict";e.exports={Model:t("./definition"),View:t("./definition_view")}},{"./definition":44,"./definition_view":45}],47:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=t("../resource_reference/resource_reference"),i=function(t,e){o.call(this,t,e)};i.type={id:"definition_reference",parent:"resource_reference",properties:{target:"definition"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),e.exports=i},{"../annotation/annotation":7,"../resource_reference/resource_reference":95,"substance-document":160}],48:[function(t,e){e.exports={Model:t("./definition_reference.js"),View:t("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":96,"./definition_reference.js":47}],49:[function(t,e){"use strict";var n=t("substance-document"),r=function(t,e){n.Node.call(this,t,e)};r.type={id:"document",parent:"content",properties:{views:["array","view"],guid:"string",creator:"string",title:"string",authors:["array","contributor"],on_behalf_of:"string","abstract":"string"}},r.Prototype=function(){},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],50:[function(t,e){"use strict";e.exports={Model:t("./document_node")}},{"./document_node":49}],51:[function(t,e){var n=t("../annotation/annotation"),r=function(t,e){n.call(this,t,e)};r.type={id:"emphasis",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,e.exports=r},{"../annotation/annotation":7}],52:[function(t,e){e.exports={Model:t("./emphasis.js"),View:t("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":8,"./emphasis.js":51}],53:[function(t,e){"use strict";var n=t("substance-document"),r=function(t,e){n.Composite.call(this,t,e)};r.type={parent:"content",properties:{source_id:"string",label:"string",url:"string",caption:"caption",attrib:"string"}},r.config={zoomable:!0},r.description={name:"Figure",remarks:["A figure is a figure is figure."],properties:{label:"Label used as header for the figure cards",url:"Image url",caption:"A reference to a caption node that describes the figure",attrib:"Figure attribution"}},r.example={id:"figure_1",label:"Figure 1",url:"http://example.com/fig1.png",caption:"caption_1"},r.Prototype=function(){this.hasCaption=function(){return!!this.properties.caption},this.getChildrenIds=function(){var t=[];return this.properties.caption&&t.push(this.properties.caption),t},this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):void 0
},this.getHeader=function(){return this.properties.label}},r.Prototype.prototype=n.Composite.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r.prototype,Object.keys(r.type.properties)),e.exports=r},{"substance-document":160}],54:[function(t,e){"use strict";var n=t("underscore"),r=t("../composite").View,o=t("substance-application").$$,i=t("../../resource_view"),s=function(t,e,n){r.call(this,t,e),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.isZoomable=!0,this.renderBody=function(){if(this.node.url){var t=o(".image-wrapper",{children:[o("a",{href:this.node.url,target:"_blank",children:[o("img",{src:this.node.url})]})]});this.content.appendChild(t)}this.renderChildren(),this.node.attrib&&this.content.appendChild(o(".figure-attribution",{text:this.node.attrib}))},this.renderLabel=function(){var t=o("a.name.action-toggle-resource",{href:"#"});return this.renderAnnotatedText([this.node.id,"label"],t),t}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"../../resource_view":117,"../composite":30,"substance-application":149,underscore:175}],55:[function(t,e){"use strict";e.exports={Model:t("./figure"),View:t("./figure_view")}},{"./figure":53,"./figure_view":54}],56:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=t("../resource_reference/resource_reference"),i=function(t,e){o.call(this,t,e)};i.type={id:"figure_reference",parent:"resource_reference",properties:{target:"figure"}},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,i.fragmentation=r.NEVER,n.Node.defineProperties(i),e.exports=i},{"../annotation/annotation":7,"../resource_reference/resource_reference":95,"substance-document":160}],57:[function(t,e){e.exports={Model:t("./figure_reference.js"),View:t("../resource_reference/resource_reference_view.js")}},{"../resource_reference/resource_reference_view.js":96,"./figure_reference.js":56}],58:[function(t,e){"use strict";var n=t("substance-document"),r=n.Node,o=t("../paragraph").Model,i=function(t,e){o.call(this,t,e)};i.type={id:"footnote",parent:"paragraph",properties:{label:"string"}},i.description={name:"Footnote",remarks:["A Footnote is basically a Paragraph with a label."],properties:{label:"A string used as label"}},i.example={type:"footnote",id:"footnote_1",label:"a","children ":["text_1","image_1","text_2"]},i.Prototype=function(){},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,r.defineProperties(i),e.exports=i},{"../paragraph":88,"substance-document":160}],59:[function(t,e){"use strict";var n=t("../paragraph").View,r=function(t,e){n.call(this,t,e)};r.Prototype=function(){this.render=function(){n.prototype.render.call(this);var t=document.createElement("span");return t.classList.add("label"),t.innerHTML=this.node.label,this.el.insertBefore(t,this.content),this}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../paragraph":88}],60:[function(t,e){"use strict";e.exports={Model:t("./footnote"),View:t("./footnote_view")}},{"./footnote":58,"./footnote_view":59}],61:[function(t,e){var n=t("substance-document"),r=function(t){n.Node.call(this,t)};r.type={id:"formula",parent:"content",properties:{source_id:"string",inline:"boolean",label:"string",format:["array","string"],data:["array","string"]}},r.description={name:"Formula",remarks:["Can either be expressed in MathML format or using an image url"],properties:{label:"Formula label (4)",data:"Formula data, either MathML or image url",format:"Can either be `mathml` or `image`"}},r.example={type:"formula",id:"formula_eqn1",label:"(1)",content:"<mml:mrow>...</mml:mrow>",format:"mathml"},r.Prototype=function(){this.inline=!1},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constuctor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],62:[function(t,e){"use strict";var n=t("../node").View,r=function(t,e){n.call(this,t,e)};r.Prototype=function(){var t={latex:"math/tex",mathml:"math/mml"},e={image:0,mathml:1,latex:2};this.render=function(){this.node.inline&&this.$el.addClass("inline");var n,r=[];for(n=0;n<this.node.data.length;n++)r.push({format:this.node.format[n],data:this.node.data[n]});if(r.sort(function(t,n){return e[t.format]-e[n.format]}),r.length>0){var o=!1,i=!1;for(n=0;n<r.length;n++){var s=r[n].format,a=r[n].data;switch(s){case"mathml":i||(this.$el.append($(a)),i=!0,o&&(this.$preview.hide(),o=!0));break;case"latex":if(!i){var c=t[s];this.node.inline||(c+="; mode=display");var u=$("<script>").attr("type",c).html(a);this.$el.append(u),i=!0}break;case"image":if(!o){var l=$("<div>").addClass("MathJax_Preview");l.append($("<img>").attr("src",a)),this.$el.append(l),this.$preview=l,o=!0}break;default:console.error("Unknown formula format:",s)}}}return this.node.label&&this.$el.append($('<div class="label">').html(this.node.label)),this}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../node":85}],63:[function(t,e){"use strict";e.exports={Model:t("./formula"),View:t("./formula_view")}},{"./formula":61,"./formula_view":62}],64:[function(t,e){"use strict";var n=t("substance-document").Node,r=t("../text/text_node"),o=function(t,e){r.call(this,t,e)};o.type={id:"heading",parent:"content",properties:{source_id:"string",content:"string",label:"string",level:"number"}},o.example={type:"heading",id:"heading_1",content:"Introduction",level:1},o.description={name:"Heading",remarks:["Denotes a section or sub section in your article."],properties:{content:"Heading title",label:"Heading label",level:"Heading level. Ranges from 1..4"}},o.Prototype=function(){this.splitInto="paragraph",this.includeInToc=function(){return!0},this.getLevel=function(){return this.level}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,n.defineProperties(o),e.exports=o},{"../text/text_node":107,"substance-document":160}],65:[function(t,e){"use strict";var n=t("../node").View,r=t("substance-application").$$,o=function(t,e){n.call(this,t,e),this.$el.addClass("level-"+this.node.level)};o.Prototype=function(){this.render=function(){n.prototype.render.call(this);var t=this.createTextPropertyView([this.node.id,"content"],{classes:"title"});if(this.node.label){var e=r(".label",{text:this.node.label});this.content.appendChild(e)}return this.content.appendChild(t.render().el),this},this.renderTocItem=function(){var t=r("div");if(this.node.label){var e=r(".label",{text:this.node.label});t.appendChild(e)}var n=r("span");return this.renderAnnotatedText([this.node.id,"content"],n),t.appendChild(n),t}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"../node":85,"substance-application":149}],66:[function(t,e){"use strict";e.exports={Model:t("./heading"),View:t("./heading_view")}},{"./heading":64,"./heading_view":65}],67:[function(t,e){var n=(t("underscore"),t("substance-document")),r=function(t,e){n.Node.call(this,t,e)};r.type={id:"html_table",parent:"content",properties:{source_id:"string",label:"string",content:"string",footers:["array","string"],caption:"caption"}},r.config={zoomable:!0},r.description={name:"HTMLTable",remarks:["A table figure which is expressed in HTML notation"],properties:{source_id:"string",label:"Label shown in the resource header.",title:"Full table title",content:"HTML data",footers:"HTMLTable footers expressed as an array strings",caption:"References a caption node, that has all the content"}},r.example={id:"html_table_1",type:"html_table",label:"HTMLTable 1.",title:"Lorem ipsum table",content:"<table>...</table>",footers:[],caption:"caption_1"},r.Prototype=function(){this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):void 0},this.getHeader=function(){return this.properties.label}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160,underscore:175}],68:[function(t,e){"use strict";var n=t("underscore"),r=t("../node").View,o=t("substance-application").$$,i=t("../../resource_view"),s=function(t,e,n){r.call(this,t,e),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.isZoomable=!0,this.renderBody=function(){var t=o(".table-wrapper",{html:this.node.content});this.content.appendChild(t);var e=o(".footers",{children:n.map(this.node.footers,function(t){return o(".footer",{html:"<b>"+t.label+"</b> "+t.content})})});if(this.node.caption){var r=this.createView(this.node.caption);this.content.appendChild(r.render().el)}this.content.appendChild(e)}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"../../resource_view":117,"../node":85,"substance-application":149,underscore:175}],69:[function(t,e){"use strict";e.exports={Model:t("./html_table"),View:t("./html_table_view")}},{"./html_table":67,"./html_table_view":68}],70:[function(t,e){"use strict";var n=(t("substance-document").Node,t("../web_resource").Model),r=function(t,e){n.call(this,t,e)};r.type={id:"image",parent:"webresource",properties:{source_id:"string"}},r.example={type:"image",id:"image_1",url:"http://substance.io/image_1.png"},r.description={name:"Image",remarks:["Represents a web-resource for an image."],properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,e.exports=r},{"../web_resource":115,"substance-document":160}],71:[function(t,e){"use strict";var n=t("../node").View,r=function(t,e){n.call(this,t,e)};r.Prototype=function(){var t=Array.prototype.indexOf;this.render=function(){var e=document.createElement("div");e.className="content";var n=document.createElement("div");n.className="image-char",this._imgChar=n;var r=document.createElement("img");return r.src=this.node.url,r.alt="alt text",r.title="alt text",n.appendChild(r),e.appendChild(n),this.el.appendChild(e),this._imgPos=t.call(n.childNodes,r),this},this.delete=function(t,e){for(var n=this.$(".content")[0],r=n.childNodes,o=e-1;o>=0;o--)n.removeChild(r[t+o])},this.getCharPosition=function(t,e){return t===this._imgChar?e>this._imgPos?1:0:void console.log("Errhhh..")},this.getDOMPosition=function(t){var e=this.$(".content")[0],n=document.createRange();return 0===t?n.setStartBefore(e.childNodes[0]):n.setStartAfter(e.childNodes[0]),n}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../node":85}],72:[function(t,e){"use strict";e.exports={Model:t("./image"),View:t("./image_view")}},{"./image":70,"./image_view":71}],73:[function(t,e){"use strict";e.exports={node:t("./node"),composite:t("./composite"),annotation:t("./annotation"),emphasis:t("./emphasis"),strong:t("./strong"),subscript:t("./subscript"),superscript:t("./superscript"),underline:t("./underline"),code:t("./code"),author_callout:t("./author_callout"),custom_annotation:t("./custom_annotation"),"inline-formula":t("./inline_formula"),resource_reference:t("./resource_reference"),contributor_reference:t("./contributor_reference"),figure_reference:t("./figure_reference"),citation_reference:t("./citation_reference"),definition_reference:t("./definition_reference"),cross_reference:t("./cross_reference"),publication_info:t("./publication_info"),link:t("./link"),inline_image:t("./inline_image"),document:t("./document"),text:t("./text"),paragraph:t("./paragraph"),heading:t("./heading"),box:t("./box"),cover:t("./cover"),figure:t("./figure"),caption:t("./caption"),image:t("./image"),webresource:t("./web_resource"),html_table:t("./html_table"),supplement:t("./supplement"),video:t("./video"),contributor:t("./contributor"),definition:t("./definition"),citation:t("./citation"),formula:t("./formula"),list:t("./list"),codeblock:t("./codeblock"),affiliation:t("./_affiliation"),footnote:t("./footnote")}},{"./_affiliation":6,"./annotation":9,"./author_callout":12,"./box":15,"./caption":18,"./citation":21,"./citation_reference":23,"./code":25,"./codeblock":28,"./composite":30,"./contributor":33,"./contributor_reference":35,"./cover":38,"./cross_reference":40,"./custom_annotation":43,"./definition":46,"./definition_reference":48,"./document":50,"./emphasis":52,"./figure":55,"./figure_reference":57,"./footnote":60,"./formula":63,"./heading":66,"./html_table":69,"./image":72,"./inline_formula":74,"./inline_image":77,"./link":79,"./list":82,"./node":85,"./paragraph":88,"./publication_info":91,"./resource_reference":94,"./strong":97,"./subscript":99,"./superscript":101,"./supplement":103,"./text":106,"./underline":110,"./video":112,"./web_resource":115}],74:[function(t,e){e.exports={Model:t("./inline_formula.js"),View:t("./inline_formula_view.js")}},{"./inline_formula.js":75,"./inline_formula_view.js":76}],75:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=function(t,e){r.call(this,t,e)};o.type={id:"inline-formula",parent:"annotation",properties:{target:"formula"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),e.exports=o},{"../annotation/annotation":7,"substance-document":160}],76:[function(t,e){"use strict";var n=t("../resource_reference").View,r=function(t,e){n.call(this,t,e),$(this.el).removeClass("resource-reference")};r.Prototype=function(){this.createElement=function(){var t=document.createElement("span");return t},this.render=function(){var t=this.node.document.get(this.node.target),e=this.viewFactory.createView(t);return this.el.innerHTML=e.render().el.innerHTML,this}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../resource_reference":94}],77:[function(t,e){e.exports={Model:t("./inline_image.js"),View:t("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":8,"./inline_image.js":78}],78:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=function(t,e){r.call(this,t,e)};o.type={id:"inline-image",parent:"annotation",properties:{target:"image"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),e.exports=o},{"../annotation/annotation":7,"substance-document":160}],79:[function(t,e){e.exports={Model:t("./link.js"),View:t("./link_view.js")}},{"./link.js":80,"./link_view.js":81}],80:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=function(t,e){r.call(this,t,e)};o.type={id:"link",parent:"annotation",properties:{url:"string"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),e.exports=o},{"../annotation/annotation":7,"substance-document":160}],81:[function(t,e){var n=t("../annotation").View,r=function(t){n.call(this,t)};r.Prototype=function(){this.createElement=function(){var t=document.createElement("a");return t.setAttribute("href",this.node.url),t},this.setClasses=function(){this.$el.addClass("link")}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../annotation":9}],82:[function(t,e){"use strict";e.exports={Model:t("./list"),View:t("./list_view")}},{"./list":83,"./list_view":84}],83:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-document"),o=r.Node,i=r.Composite,s=function(t,e){i.call(this,t,e)};s.type={id:"list",parent:"content",properties:{source_id:"string",items:["array","paragraph"],ordered:"boolean"}},s.description={name:"List",remarks:["Lists can either be numbered or bullet lists"],properties:{ordered:"Specifies wheter the list is ordered or not",items:"An array of paragraph references"}},s.example={type:"list",id:"list_1","items ":["paragraph_listitem_1","paragraph_listitem_2"]},s.Prototype=function(){this.getLength=function(){return this.properties.items.length},this.getChildrenIds=function(){return n.clone(this.items)},this.getItems=function(){return n.map(this.properties.items,function(t){return this.document.get(t)},this)},this.getChangePosition=function(t){if("items"===t.path[1])if("update"===t.type){var e=t.diff;if(e.isInsert())return t.diff.pos+1;if(e.isDelete())return t.diff.pos;if(e.isMove())return t.diff.target}else if("set"===t.type)return this.properties.items.length-1;return-1},this.isMutable=function(){return!0},this.insertChild=function(t,e,n){t.update([this.id,"items"],["+",e,n])},this.deleteChild=function(t,e){var n=this.items.indexOf(e);t.update([this.id,"items"],["-",n,e]),t.delete(e)},this.canJoin=function(t){return"list"===t.type},this.isBreakable=function(){return!0},this.break=function(t,e,n){var r=this.properties.items.indexOf(e);if(0>r)throw new Error("Unknown child "+e);var o=t.get(e),i=o.break(t,n);return t.update([this.id,"items"],["+",r+1,i.id]),i}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,o.defineProperties(s.prototype,["items","ordered"]),e.exports=s},{"substance-document":160,underscore:175}],84:[function(t,e){"use strict";var n=t("../composite/composite_view"),r=t("./list"),o=function(t,e){n.call(this,t,e)};o.whoami="SubstanceListView",o.Prototype=function(){this.render=function(){this.el.innerHTML="";var t=this.node.ordered?"OL":"UL";this.content=document.createElement(t),this.content.classList.add("content");var e;for(e=0;e<this.childrenViews.length;e++)this.childrenViews[e].dispose();var n=this.node.getNodes();for(e=0;e<n.length;e++){var o,i=this.node.document.get(n[e]),s=this.viewFactory.createView(i);i instanceof r?o=s.render().el:(o=document.createElement("LI"),o.appendChild(s.render().el)),this.content.appendChild(o),this.childrenViews.push(s)}return this.el.appendChild(this.content),this},this.onNodeUpdate=function(t){t.path[0]===this.node.id&&"items"===t.path[1]&&this.render()}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"../composite/composite_view":29,"./list":83}],85:[function(t,e){"use strict";e.exports={Model:t("./node"),View:t("./node_view")}},{"./node":86,"./node_view":87}],86:[function(t,e){"use strict";var n=t("substance-document"),r=n.Node;r.description={name:"Node",remarks:["Abstract node type."],properties:{source_id:"Useful for document conversion where the original id of an element should be remembered."}},e.exports=r},{"substance-document":160}],87:[function(t,e){"use strict";var n=t("substance-application").View,r=t("../text/text_property_view"),o=function(t,e,r){if(n.call(this,r),this.node=t,this.viewFactory=e,!e)throw new Error('Illegal argument. Argument "viewFactory" is mandatory.');this.$el.addClass("content-node").addClass(t.type.replace("_","-")),this.el.dataset.id=this.node.id};o.Prototype=function(){this.render=function(){return this.content=document.createElement("DIV"),this.content.classList.add("content"),this.focusHandle=document.createElement("DIV"),this.focusHandle.classList.add("focus-handle"),this.el.appendChild(this.content),this.el.appendChild(this.focusHandle),this},this.dispose=function(){this.stopListening()},this.createView=function(t){var e=this.node.document.get(t),n=this.viewFactory.createView(e);return n},this.createTextView=function(t){console.error("FIXME: NodeView.createTextView() is deprecated. Use NodeView.createTextPropertyView() instead.");var e=this.viewFactory.createView(this.node,t,"text");return e},this.createTextPropertyView=function(t,e){var n=new r(this.node.document,t,this.viewFactory,e);return n},this.renderAnnotatedText=function(t,e){var n=this.node.document.resolve(t),o=r.renderAnnotatedText(this.node.document,n,e,this.viewFactory);return o}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"../text/text_property_view":108,"substance-application":149}],88:[function(t,e){"use strict";e.exports={Model:t("./paragraph"),View:t("./paragraph_view")}},{"./paragraph":89,"./paragraph_view":90}],89:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-document"),o=r.Node,i=r.Composite,s=function(t,e){i.call(this,t,e)};s.type={id:"paragraph",parent:"content",properties:{children:["array","content"]}},s.description={name:"Paragraph",remarks:["A Paragraph can have inline elements such as images."],properties:{children:"An array of content node references"}},s.example={type:"paragraph",id:"paragraph_1","children ":["text_1","image_1","text_2"]},s.Prototype=function(){this.getLength=function(){return this.properties.children.length},this.getChildrenIds=function(){return n.clone(this.properties.children)},this.getChildren=function(){return n.map(this.properties.children,function(t){return this.document.get(t)},this)}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,o.defineProperties(s.prototype,["children"]),e.exports=s},{"substance-document":160,underscore:175}],90:[function(t,e){"use strict";var n=t("../composite/composite_view"),r=function(t,e){n.call(this,t,e)};r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../composite/composite_view":29}],91:[function(t,e){"use strict";e.exports={Model:t("./publication_info"),View:t("./publication_info_view")}},{"./publication_info":92,"./publication_info_view":93}],92:[function(t,e){"use strict";var n=t("substance-document"),r=function(t,e){n.Node.call(this,t,e)};r.type={id:"publication_info",parent:"content",properties:{history:["array","object"],published_on:"string",journal:"string",provider:"string",article_type:"string",keywords:["array","string"],research_organisms:["array","string"],subjects:["array","string"],links:["array","objects"],doi:"string",related_article:"string",article_info:"paragraph"}},r.description={name:"PublicationInfo",description:"PublicationInfo Node",remarks:["Summarizes the article's meta information. Meant to be customized by publishers"],properties:{received_on:"Submission received",accepted_on:"Paper accepted on",published_on:"Paper published on",history:"History of the submission cycle",journal:"The Journal",provider:"Who is hosting this article",article_type:"Research Article vs. Insight, vs. Correction etc.",keywords:"Article's keywords",research_organisms:"Research Organisms",subjects:"Article Subjects",doi:"Article DOI",related_article:"DOI of related article if there is any"}},r.example={id:"publication_info",published_on:"2012-11-13",history:[{type:"received",date:"2012-06-20"},{type:"accepted",date:"2012-09-05"}],journal:"eLife",provider:"eLife",article_type:"Research Article",keywords:["innate immunity","histones","lipid droplet","anti-bacterial"],research_organisms:["B. subtilis","D. melanogaster","E. coli","Mouse"],subjects:["Immunology","Microbiology and infectious disease"],doi:"http://dx.doi.org/10.7554/eLife.00003"},r.Prototype=function(){this.getArticleInfo=function(){return this.document.get("articleinfo")}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],93:[function(t,e){"use strict";var n=t("../node").View,r=t("substance-application").$$,o=t("../../article_util"),i={received:"received",accepted:"accepted",revised:"revised",corrected:"corrected","rev-recd":"revised","rev-request":"returned for modification",published:"published","default":"updated"},s=function(t,e){n.call(this,t,e)};s.Prototype=function(){this.render=function(){n.prototype.render.call(this);var t=r(".meta-data");if(this.node.article_type){var e=r(".article-type.container",{children:[r("div.label",{text:"Article Type"}),r("div.value",{text:this.node.article_type})]});t.appendChild(e)}if(this.node.subjects&&this.node.subjects.length>0){var o=r(".subject.container",{children:[r("div.label",{text:"Subject"}),r("div.value",{text:this.node.subjects.join(", ")})]});t.appendChild(o)}if(this.node.research_organisms&&this.node.research_organisms.length>0){var i=r(".subject.container",{children:[r("div.label",{text:"Organism"}),r("div.value",{text:this.node.research_organisms.join(", ")})]});t.appendChild(i)}if(this.node.keywords&&this.node.keywords.length>0){var s=r(".keywords.container",{children:[r("div.label",{text:"Keywords"}),r("div.value",{text:this.node.keywords.join(", ")})]});t.appendChild(s)}if(this.node.doi){var a=r(".doi.container",{children:[r("div.label",{text:"DOI"}),r("div.value",{children:[r("a",{href:"http://dx.doi.org/"+this.node.doi,text:this.node.doi,target:"_blank"})]})]});t.appendChild(a)}if(this.node.related_article){var c=r(".related-article.container",{children:[r("div.label",{text:"Related Article"}),r("div.value",{children:[r("a",{href:this.node.related_article,text:this.node.related_article})]})]});t.appendChild(c)}var u=this.describePublicationHistory();t.appendChild(u),this.content.appendChild(t);var l=this.node.getArticleInfo(),p=this.viewFactory.createView(l),h=p.render().el;return this.content.appendChild(h),this},this.describePublicationHistory=function(){var t,e=r(".dates"),n=[];if(this.node.history&&this.node.history.length>0&&(n=n.concat(this.node.history)),this.node.published_on&&n.push({type:"published",date:this.node.published_on}),n.length>0){for(e.appendChild(document.createTextNode("The article was ")),t=0;t<n.length;t++){t>0&&(e.appendChild(document.createTextNode(", ")),t===n.length-1&&e.appendChild(document.createTextNode("and ")));var s=n[t];e.appendChild(document.createTextNode((i[s.type]||i.default)+" on ")),e.appendChild(r("b",{text:o.formatDate(s.date)}))}e.appendChild(document.createTextNode("."))}return e},this.dispose=function(){n.prototype.dispose.call(this)}},s.Prototype.prototype=n.prototype,s.prototype=new s.Prototype,e.exports=s},{"../../article_util":3,"../node":85,"substance-application":149}],94:[function(t,e){e.exports={Model:t("./resource_reference.js"),View:t("./resource_reference_view.js")}},{"./resource_reference.js":95,"./resource_reference_view.js":96}],95:[function(t,e){var n=t("substance-document"),r=t("../annotation/annotation"),o=function(t,e){r.call(this,t,e)};o.type={id:"resource_reference",parent:"annotation",properties:{target:"node"}},o.Prototype=function(){},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,o.fragmentation=r.NEVER,n.Node.defineProperties(o),e.exports=o},{"../annotation/annotation":7,"substance-document":160}],96:[function(t,e){"use strict";var n=t("../annotation/annotation_view"),r=function(t,e){n.call(this,t,e),this.$el.addClass("resource-reference")};r.Prototype=function(){this.createElement=function(){var t=document.createElement("a");return t.setAttribute("href",""),t}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"../annotation/annotation_view":8}],97:[function(t,e){e.exports={Model:t("./strong.js"),View:t("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":8,"./strong.js":98}],98:[function(t,e){var n=t("../annotation/annotation"),r=function(t,e){n.call(this,t,e)};r.type={id:"strong",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,e.exports=r},{"../annotation/annotation":7}],99:[function(t,e){e.exports={Model:t("./subscript.js"),View:t("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":8,"./subscript.js":100}],100:[function(t,e){var n=t("../annotation/annotation"),r=function(t,e){n.call(this,t,e)};r.type={id:"subscript",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,e.exports=r},{"../annotation/annotation":7}],101:[function(t,e){e.exports={Model:t("./superscript.js"),View:t("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":8,"./superscript.js":102}],102:[function(t,e){var n=t("../annotation/annotation"),r=function(t,e){n.call(this,t,e)};r.type={id:"superscript",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,e.exports=r},{"../annotation/annotation":7}],103:[function(t,e){"use strict";e.exports={Model:t("./supplement"),View:t("./supplement_view")}},{"./supplement":104,"./supplement_view":105}],104:[function(t,e){var n=(t("underscore"),t("substance-document")),r=function(t,e){n.Composite.call(this,t,e)};r.type={id:"supplement",parent:"content",properties:{source_id:"string",label:"string",url:"string",caption:"caption"}},r.description={name:"Supplement",remarks:["A Supplement entity."],properties:{source_id:"Supplement id as it occurs in the source NLM file",label:"Supplement label",caption:"References a caption node, that has all the content",url:"URL of downloadable file"}},r.example={id:"supplement_1",source_id:"SD1-data",type:"supplement",label:"Supplementary file 1.",url:"http://myserver.com/myfile.pdf",caption:"caption_supplement_1"},r.Prototype=function(){this.getChildrenIds=function(){var t=[];return this.properties.caption&&t.push(this.properties.caption),t},this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):null},this.getHeader=function(){return this.properties.label}},r.Prototype.prototype=n.Composite.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160,underscore:175}],105:[function(t,e){"use strict";var n=t("underscore"),r=t("../composite").View,o=t("substance-application").$$,i=t("../../resource_view"),s=function(t,e,n){r.call(this,t,e),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.renderBody=function(){this.renderChildren();var t=o("div.file",{children:[o("a",{href:this.node.url,html:'<i class="fa fa-download"/> Download'})]});this.content.appendChild(t)}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,e.exports=s},{"../../resource_view":117,"../composite":30,"substance-application":149,underscore:175}],106:[function(t,e){"use strict";e.exports={Model:t("./text_node"),View:t("./text_view")}},{"./text_node":107,"./text_view":109}],107:[function(t,e){"use strict";var n=t("substance-document");e.exports=n.TextNode},{"substance-document":160}],108:[function(t,e){"use strict";var n=t("substance-util"),r=n.Fragmenter,o=t("substance-application").View,i=function(t,e,n,r){r=r||{},r.elementType=r.elementType||"span",o.call(this,r),this.path=e,this.document=t,this.viewFactory=n,this.options=r||{},this.property=t.resolve(this.path),this.$el.addClass("text"),this.options.classes&&this.$el.addClass(this.options.classes)};i.Prototype=function(){this.render=function(){return this.el.innerHTML="",i.renderAnnotatedText(this.document,this.property,this.el,this.viewFactory),this},this.dispose=function(){this.stopListening()},this.renderWithAnnotations=function(t){var e=this,n=this.property.get(),o=document.createDocumentFragment(),i=this.document,s=[],a=new r;a.onText=function(t,e){t.appendChild(document.createTextNode(e))},a.onEnter=function(t,n){var r=i.get(t.id),o=e.viewFactory.createView(r);return n.appendChild(o.el),s.push(o),o.el},a.start(o,n,t);for(var c=0;c<s.length;c++)s[c].render();this.el.innerHTML="",this.el.appendChild(o)}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.renderAnnotatedText=function(t,e,n,o){var i=window.document.createDocumentFragment(),s=e.get(),a=t.getIndex("annotations").get(e.path),c=[],u=new r;u.onText=function(t,e){t.appendChild(window.document.createTextNode(e))},u.onEnter=function(e,n){var r=t.get(e.id),i=o.createView(r);return n.appendChild(i.el),c.push(i),i.el},u.start(i,s,a);for(var l=0;l<c.length;l++)c[l].render();n.appendChild(i)},e.exports=i},{"substance-application":149,"substance-util":167}],109:[function(t,e){"use strict";var n=t("substance-util"),r=n.Fragmenter,o=t("../node/node_view"),i=t("substance-application").$$,s=function(t,e,n){o.call(this,t,e),n=this.options=n||{},this.path=n.path||[t.id,"content"],this.property=t.document.resolve(this.path),this.$el.addClass("text"),n.classes&&this.$el.addClass(n.classes),n.path&&this.$el.removeClass("content-node"),this._annotations={}
};s.Prototype=function(){this.render=function(){return o.prototype.render.call(this),this.renderContent(),this},this.dispose=function(){o.prototype.dispose.call(this)},this.renderContent=function(){this.content.innerHTML="",this._annotations=this.node.document.getIndex("annotations").get(this.path),this.renderWithAnnotations(this._annotations)},this.createAnnotationElement=function(t){if(this.options.createAnnotationElement)return this.options.createAnnotationElement.call(this,t);var e;return e="link"===t.type?i("a.annotation."+t.type,{id:t.id,href:this.node.document.get(t.id).url}):i("span.annotation."+t.type,{id:t.id})},this.renderWithAnnotations=function(t){var e=this,n=this.property.get(),o=document.createDocumentFragment(),i=this.node.document,s=[],a=new r;a.onText=function(t,e){t.appendChild(document.createTextNode(e))},a.onEnter=function(t,n){var r=i.get(t.id),o=e.viewFactory.createView(r);return n.appendChild(o.el),s.push(o),o.el},a.start(o,n,t);for(var c=0;c<s.length;c++)s[c].render();this.content.innerHTML="",this.content.appendChild(o)}},s.Prototype.prototype=o.prototype,s.prototype=new s.Prototype,e.exports=s},{"../node/node_view":87,"substance-application":149,"substance-util":167}],110:[function(t,e){e.exports={Model:t("./underline.js"),View:t("../annotation/annotation_view.js")}},{"../annotation/annotation_view.js":8,"./underline.js":111}],111:[function(t,e){var n=t("../annotation/annotation"),r=function(t,e){n.call(this,t,e)};r.type={id:"underline",parent:"annotation",properties:{}},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,r.fragmentation=n.DONT_CARE,e.exports=r},{"../annotation/annotation":7}],112:[function(t,e){"use strict";e.exports={Model:t("./video"),View:t("./video_view")}},{"./video":113,"./video_view":114}],113:[function(t,e){var n=t("substance-document"),r=function(t,e){n.Node.call(this,t,e)};r.type={id:"video",parent:"content",properties:{source_id:"string",label:"string",url:"string",url_webm:"string",url_ogv:"string",caption:"caption",poster:"string"}},r.config={zoomable:!0},r.description={name:"Video",remarks:["A video type intended to refer to video resources.","MP4, WebM and OGV formats are supported."],properties:{label:"Label shown in the resource header.",url:"URL to mp4 version of the video.",url_webm:"URL to WebM version of the video.",url_ogv:"URL to OGV version of the video.",poster:"Video poster image.",caption:"References a caption node, that has all the content"}},r.example={id:"video_1",type:"video",label:"Video 1.",url:"http://cdn.elifesciences.org/video/eLifeLensIntro2.mp4",url_webm:"http://cdn.elifesciences.org/video/eLifeLensIntro2.webm",url_ogv:"http://cdn.elifesciences.org/video/eLifeLensIntro2.ogv",poster:"http://cdn.elifesciences.org/video/eLifeLensIntro2.png",caption:"caption_25"},r.Prototype=function(){this.getHeader=function(){return this.properties.label},this.getCaption=function(){return this.properties.caption?this.document.get(this.properties.caption):""}},r.Prototype.prototype=n.Node.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.Node.defineProperties(r),e.exports=r},{"substance-document":160}],114:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").$$,o=t("../node").View,i=t("../../resource_view"),s=function(t,e,n){o.call(this,t,e),i.call(this,n)};s.Prototype=function(){n.extend(this,i.prototype),this.isZoomable=!0,this.renderBody=function(){var t=this.node,e=[r("source",{src:t.url,type:"video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;"})];t.url_ogv&&e.push(r("source",{src:t.url_ogv,type:"video/ogg; codecs=&quot;theora, vorbis&quot;"})),t.url_webm&&e.push(r("source",{src:t.url_webm,type:"video/webm"}));var n=r(".video-wrapper",{children:[r("video",{controls:"controls",poster:t.poster,preload:"none",children:e})]});if(this.content.appendChild(n),t.title&&this.content.appendChild(r(".title",{text:t.title})),this.node.caption){var o=this.createView(this.node.caption);this.content.appendChild(o.render().el),this.captionView=o}t.doi&&this.content.appendChild(r(".doi",{children:[r("b",{text:"DOI: "}),r("a",{href:t.doi,target:"_new",text:t.doi})]}))}},s.Prototype.prototype=o.prototype,s.prototype=new s.Prototype,e.exports=s},{"../../resource_view":117,"../node":85,"substance-application":149,underscore:175}],115:[function(t,e){"use strict";e.exports={Model:t("./web_resource"),View:t("../node").View}},{"../node":85,"./web_resource":116}],116:[function(t,e){"use strict";var n=t("substance-document").Node,r=function(t,e){n.call(this,t,e)};r.type={id:"webresource",parent:"content",properties:{source_id:"string",url:"string"}},r.description={name:"WebResource",description:"A resource which can be accessed via URL",remarks:["This element is a parent for several other nodes such as Image."],properties:{url:"URL to a resource"}},r.example={type:"webresource",id:"webresource_3",url:"http://elife.elifesciences.org/content/elife/1/e00311/F3.medium.gif"},r.Prototype=function(){},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.defineProperties(r.prototype,["url"]),e.exports=r},{"substance-document":160}],117:[function(t,e){"use strict";var n=t("underscore"),r=t("./nodes/node").View,o=t("substance-application").$$,i={header:!1,zoom:!1},s=function(t){this.options=n.extend({},i,t)};s.Prototype=function(){this.isResourceView=!0,this.render=function(){return r.prototype.render.call(this),this.renderHeader(),this.renderBody(),this},this.renderHeader=function(){this.node;if(this.options.header){var t=o(".resource-header");t.appendChild(this.renderLabel()),this.options.zoom&&t.appendChild(o("a.toggle-fullscreen",{href:"#",html:'<i class="fa fa-expand"></i><i class="fa fa-compress"></i>'})),t.appendChild(o("a.toggle-res.action-toggle-resource",{href:"#",html:'<i class="fa fa-eye"></i><i class="fa fa-eye-slash"></i>'})),this.headerEl=t,this.el.insertBefore(t,this.content)}},this.renderLabel=function(){var t=o("a.name.action-toggle-resource",{href:"#",html:this.getHeader()});return t},this.renderBody=function(){},this.getHeader=function(){return this.node.getHeader()}},s.prototype=new s.Prototype,e.exports=s},{"./nodes/node":85,"substance-application":149,underscore:175}],118:[function(t,e){var n=function(t,e){this.nodeTypes=t,this.options=e||{}};n.Prototype=function(){this.getNodeViewClass=function(t,e){e=e||t.type;var n=this.nodeTypes[e];if(!n)throw new Error("No node registered for type "+e+".");var r=n.View;if(!r)throw new Error('No view registered for type "'+t.type+'".');return r},this.createView=function(t,e,n){var r=this.getNodeViewClass(t,n),o=new r(t,this,e);return o}},n.prototype=new n.Prototype,e.exports=n},{}],119:[function(t,e){"use strict";var n=t("substance-util"),r=t("underscore"),o=t("lens-converter"),i=function(t){o.call(this,t)};i.Prototype=function(){var t=o.prototype;this.test=function(t){var e=t.querySelector("publisher-name").textContent;return"eLife Sciences Publications, Ltd"===e},this.__ignoreCustomMetaNames=["elife-xml-version"],this.enhanceArticle=function(t,e){var r,o,i=[],s=t.doc,a=e.querySelector("#SA1");a&&(r={id:t.nextId("heading"),type:"heading",level:1,content:"Article Commentary"},s.create(r),i.push(r),r={id:t.nextId("heading"),type:"heading",level:2,content:"Decision letter"},s.create(r),i.push(r),o=a.querySelector("body"),i=i.concat(this.bodyNodes(t,n.dom.getChildren(o))));var c=e.querySelector("#SA2");c&&(r={id:t.nextId("heading"),type:"heading",level:2,content:"Author response"},s.create(r),i.push(r),o=c.querySelector("body"),i=i.concat(this.bodyNodes(t,n.dom.getChildren(o)))),i.length>0&&this.show(t,i)},this.enhanceCover=function(t,e,n){var r,o=n.querySelector("subj-group[subj-group-type=display-channel] subject").textContent;try{r=n.querySelector("subj-group[subj-group-type=heading] subject").textContent}catch(i){r=null}e.breadcrumbs=[{name:"eLife",url:"http://elifesciences.org/",image:"http://lens.elifesciences.org/lens-elife/styles/elife.png"},{name:o,url:"http://elifesciences.org/category/"+o.replace(/ /g,"-").toLowerCase()}],r&&e.breadcrumbs.push({name:r,url:"http://elifesciences.org/category/"+r.replace(/ /g,"-").toLowerCase()})},this.enhanceFigure=function(t,e,n){var r=n.querySelector("graphic"),o=r.getAttribute("xlink:href");e.url=this.resolveURL(t,o)},this.resolveURL=function(t,e){if(e.match(/http:\/\//))return e;var n=this.getBaseURL(t);return n?[n,e].join(""):["http://cdn.elifesciences.org/elife-articles/",t.doc.id,"/jpg/",e,".jpg"].join("")},this.enhanceSupplement=function(t,e){var n=this.getBaseURL(t);return n?[n,e.url].join(""):void(e.url=["http://cdn.elifesciences.org/elife-articles/",t.doc.id,"/suppl/",e.url].join(""))},this.enhancePublicationInfo=function(t){var e=t.xmlDoc.querySelector("article"),n=e.querySelector("article-meta"),o=t.doc.get("publication_info"),i=n.querySelectorAll("kwd-group[kwd-group-type=research-organism] kwd"),s=n.querySelectorAll("kwd-group[kwd-group-type=author-keywords] kwd"),a=n.querySelectorAll("subj-group[subj-group-type=heading] subject"),c=n.querySelector("subj-group[subj-group-type=display-channel] subject"),u=e.querySelector("self-uri[content-type=pdf]"),l=["http://cdn.elifesciences.org/elife-articles/",t.doc.id,"/pdf/",u?u.getAttribute("xlink:href"):"#"].join(""),p=[];l&&p.push({url:l,name:"PDF",type:"pdf"}),p.push({url:"https://s3.amazonaws.com/elife-cdn/elife-articles/"+t.doc.id+"/elife"+t.doc.id+".xml",name:"Source XML",type:"xml"}),p.push({url:"",name:"Lens JSON",type:"json"}),o.research_organisms=r.pluck(i,"textContent"),o.keywords=r.pluck(s,"textContent"),o.subjects=r.pluck(a,"textContent"),o.article_type=c?c.textContent:"",o.links=p,o.related_article&&(o.related_article="http://dx.doi.org/"+o.related_article)},this.enhanceSupplement=function(t,e){var n=this.getBaseURL(t);return n?[n,e.url].join(""):void(e.url=["http://cdn.elifesciences.org/elife-articles/",t.doc.id,"/suppl/",e.url].join(""))},this.enhanceVideo=function(t,e,n){var r=n.getAttribute("xlink:href").split("."),o=r[0];e.url="http://api.elifesciences.org/v2/articles/"+t.doc.id+"/media/file/"+o+".mp4",e.url_ogv="http://api.elifesciences.org/v2/articles/"+t.doc.id+"/media/file//"+o+".ogv",e.url_webm="http://api.elifesciences.org/v2/articles/"+t.doc.id+"/media/file//"+o+".webm",e.poster="http://api.elifesciences.org/v2/articles/"+t.doc.id+"/media/file/"+o+".jpg"},this.resolveURL=function(t,e){if(e.match(/http:\/\//))return e;var n=this.getBaseURL(t);return n?[n,e].join(""):["http://cdn.elifesciences.org/elife-articles/",t.doc.id,"/jpg/",e,".jpg"].join("")};var e=/author-callout-style/;this.enhanceAnnotationData=function(t,n,r,o){if("named-content"===o){var i=r.getAttribute("content-type");e.test(i)&&(n.type="author_callout",n.style=i)}},this.showNode=function(e,n){switch(n.type){case"box":n.label&&e.doc.show("figures",n.id);break;default:t.showNode.apply(this,arguments)}}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,e.exports=i},{"lens-converter":120,"substance-util":167,underscore:175}],120:[function(t,e){"use strict";var n=t("./lens_converter");e.exports=n},{"./lens_converter":121}],121:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=r.errors,i=o.define("ImporterError"),s=function(t){this.options=t||s.DefaultOptions};s.Prototype=function(){this._annotationTypes={bold:"strong",italic:"emphasis",monospace:"code",sub:"subscript",sup:"superscript",sc:"custom_annotation",underline:"underline","ext-link":"link",xref:"",email:"link","named-content":"","inline-formula":"inline-formula",uri:"link"},this._refTypeMapping={bibr:"citation_reference",fig:"figure_reference",table:"figure_reference","supplementary-material":"figure_reference",other:"figure_reference",list:"definition_reference"},this._contribTypeMapping={author:"Author","author non-byline":"Author",autahor:"Author",auther:"Author",editor:"Editor","guest-editor":"Guest Editor","group-author":"Group Author",collab:"Collaborator","reviewed-by":"Reviewer","nominated-by":"Nominator",corresp:"Corresponding Author",other:"Other","assoc-editor":"Associate Editor","associate editor":"Associate Editor","series-editor":"Series Editor",contributor:"Contributor",chairman:"Chairman","monographs-editor":"Monographs Editor","contrib-author":"Contributing Author",organizer:"Organizer",chair:"Chair",discussant:"Discussant",presenter:"Presenter","guest-issue-editor":"Guest Issue Editor",participant:"Participant",translator:"Translator"},this.test=function(){return!0},this.isAnnotation=function(t){return void 0!==this._annotationTypes[t]},this.isParagraphish=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(n.nodeType!==Node.TEXT_NODE&&!this.isAnnotation(n.tagName.toLowerCase()))return!1}return!0},this.test=function(){},this.getName=function(t){if(!t)return"N/A";var e=[],n=t.querySelector("surname"),r=t.querySelector("given-names"),o=t.querySelector("suffix");return r&&e.push(r.textContent),n&&e.push(n.textContent),o?[e.join(" "),o.textContent].join(", "):e.join(" ")},this.toHtml=function(t){if(!t)return"";var e=document.createElement("DIV");return e.appendChild(t.cloneNode(!0)),e.innerHTML},this.mmlToHtmlString=function(t){var e=this.toHtml(t);return e=e.replace(/<(\/)?mml:([^>]+)>/g,"<$1$2>")},this.selectDirectChildren=function(t,e){for(var n=[],r=t.querySelectorAll(e),o=0;o<r.length;o++){var i=r[o];i.parentElement===t&&n.push(i)}return n},this.import=function(t){var e;if(n.isString(t)){var r=new DOMParser;e=r.parseFromString(t,"text/xml")}else e=t;this.sanitizeXML(e);var o=this.createDocument();window.doc=o;var i=this.createState(e,o);return this.document(i,e)},this.sanitizeXML=function(){},this.createState=function(t,e){return new s.State(this,t,e)},this.createDocument=function(){var e=t("lens-article"),n=new e;return n},this.show=function(t,e){n.each(e,function(e){this.showNode(t,e)},this)},this.extractDate=function(t){if(!t)return null;var e=t.querySelector("year"),n=t.querySelector("month"),r=t.querySelector("day"),o=[e.textContent];return n&&o.push(n.textContent),r&&o.push(r.textContent),o.join("-")},this.extractPublicationInfo=function(t,e){for(var n=t.doc,r=e.querySelector("article-meta"),o=r.querySelector("pub-date"),i=r.querySelectorAll("history date"),s=e.querySelector("journal-title"),a=e.querySelector("article-id[pub-id-type=doi]"),c=e.querySelector("related-article"),u=this.extractArticleInfo(t,e),l={id:"publication_info",type:"publication_info",published_on:this.extractDate(o),journal:s?s.textContent:"",related_article:c?c.getAttribute("xlink:href"):"",doi:a?a.textContent:"",article_info:u.id,article_type:"",keywords:[],links:[],subjects:[],supplements:[],history:[],research_organisms:[],provider:""},p=0;p<i.length;p++){var h=i[p],d={type:h.getAttribute("date-type"),date:this.extractDate(h)};l.history.push(d)}n.create(l),n.show("info",l.id,0),this.enhancePublicationInfo(t,l)},this.extractArticleInfo=function(t,e){var n={id:"articleinfo",type:"paragraph"},r=t.doc,o=[];return o=o.concat(this.extractEditor(t,e)),o=o.concat(this.extractDatasets(t,e)),o=o.concat(this.extractCustomMetaGroup(t,e)),o=o.concat(this.extractAcknowledgements(t,e)),o=o.concat(this.extractCopyrightAndLicense(t,e)),o=o.concat(this.extractNotes(t,e)),n.children=o,r.create(n),n},this.extractEditor=function(t,e){var n=[],r=t.doc,o=e.querySelector("contrib[contrib-type=editor]");if(o){var i=[],s=this.getName(o.querySelector("name"));s&&i.push(s);var a=o.querySelector("institution");a&&i.push(a.textContent);var c=o.querySelector("country");c&&i.push(c.textContent);var u={type:"heading",id:t.nextId("heading"),level:3,content:"Reviewing Editor"};r.create(u),n.push(u.id);var l={type:"text",id:t.nextId("text"),content:i.join(", ")};r.create(l),n.push(l.id)}return n},this.extractDatasets=function(t,e){for(var n=[],o=t.doc,i=e.querySelectorAll("sec"),s=0;s<i.length;s++){var a=i[s],c=a.getAttribute("sec-type");if("datasets"===c){var u={type:"heading",id:t.nextId("heading"),level:3,content:"Major Datasets"};o.create(u),n.push(u.id);for(var l=this.datasets(t,r.dom.getChildren(a)),p=0;p<l.length;p++)l[p]&&n.push(l[p])}}return n};var e=function(t,n){return n?t.split(" ").map(function(t){return e(t)}).join(" "):t.charAt(0).toUpperCase()+t.slice(1)};this.capitalized=function(t,n){return e(t,n)},this.extractAcknowledgements=function(t,e){var o=[],i=t.doc,s=e.querySelectorAll("ack");return s&&s.length>0&&n.each(s,function(e){var s=e.querySelector("title"),a={type:"heading",id:t.nextId("heading"),level:3,content:s?this.capitalized(s.textContent.toLowerCase(),"all"):"Acknowledgements"};i.create(a),o.push(a.id);var c=this.bodyNodes(t,r.dom.getChildren(e),{ignore:["title"]});n.each(c,function(t){o.push(t.id)})},this),o},this.extractNotes=function(){var t=[];return t},this.__ignoreCustomMetaNames=[],this.extractCustomMetaGroup=function(t,e){var r=[],o=t.doc,i=e.querySelectorAll("article-meta-group custom-meta");if(0===i.length)return r;for(var s=0;s<i.length;s++){var a=i[s],c=a.querySelector("meta-name"),u=a.querySelector("meta-value");if(!n.include(this.__ignoreCustomMetaNames,c.textContent)){var l={type:"heading",id:t.nextId("heading"),level:3,content:""};l.content=this.annotatedText(t,c,[l.id,"content"]),o.create(l);var p=this.paragraphGroup(t,u);r.push(l.id),r=r.concat(n.pluck(p,"id"))}}return r},this.extractCopyrightAndLicense=function(t,e){var o=[],i=t.doc,s=e.querySelector("permissions");if(s){var a={type:"heading",id:t.nextId("heading"),level:3,content:"Copyright & License"};i.create(a),o.push(a.id);var c,u=s.querySelector("copyright-statement");if(u&&(c=this.paragraphGroup(t,u),c&&c.length&&(o=o.concat(n.map(c,function(t){return t.id})),"."!==u.textContent.trim().slice(-1)))){var l=n.last(n.last(c).children);i.nodes[l].content+=". "}var p=s.querySelector("license");if(p)for(var h=p.firstElementChild;h;h=h.nextElementSibling){var d=r.dom.getNodeType(h);("p"===d||"license-p"===d)&&(c=this.paragraphGroup(t,h),c&&c.length&&(o=o.concat(n.pluck(c,"id"))))}}return o},this.extractCover=function(t,e){var r=t.doc,o=r.get("document"),i={id:"cover",type:"cover",title:o.title,authors:[],"abstract":o.abstract};n.each(o.authors,function(e){var n=r.get(e),o={id:"text_"+e+"_reference",type:"text",content:n.name};r.create(o),i.authors.push(o.id);var s={id:t.nextId("contributor_reference"),type:"contributor_reference",path:["text_"+e+"_reference","content"],range:[0,n.name.length],target:e};r.create(s)},this),this.enhanceCover(t,i,e),r.create(i),r.show("content",i.id,0)},this.contribGroup=function(t,e){var n,r=e.querySelectorAll("contrib");for(n=0;n<r.length;n++)this.contributor(t,r[n]);var o=t.doc,i=e.querySelector("on-behalf-of");i&&(o.on_behalf_of=i.textContent.trim())},this.affiliation=function(t,e){var n=t.doc,r=e.querySelector("institution"),o=e.querySelector("country"),i=e.querySelector("label"),s=e.querySelector("addr-line named-content[content-type=department]"),a=e.querySelector("addr-line named-content[content-type=city]"),c={id:t.nextId("affiliation"),type:"affiliation",source_id:e.getAttribute("id"),label:i?i.textContent:null,department:s?s.textContent:null,city:a?a.textContent:null,institution:r?r.textContent:null,country:o?o.textContent:null};n.create(c)},this.contributor=function(t,e){var o=t.doc,i=t.nextId("contributor"),s={id:i,source_id:e.getAttribute("id"),type:"contributor",name:"",affiliations:[],fundings:[],bio:[],image:"",deceased:!1,emails:[],contribution:"",members:[]},a=e.getAttribute("contrib-type");s.contributor_type=this._contribTypeMapping[a];var c=e.querySelector("role");c&&(s.role=c.textContent);var u=e.querySelector("bio");u&&n.each(r.dom.getChildren(u),function(e){var n=e.querySelector("graphic");if(n){var r=n.getAttribute("xlink:href");s.image=r}else{var o=this.paragraphGroup(t,e);o.length>0&&(s.bio=[o[0].id])}},this),"yes"===e.getAttribute("deceased")&&(s.deceased=!0);var l=e.querySelector("uri[content-type=orcid]");l&&(s.orcid=l.getAttribute("xlink:href"));var p=e.querySelector("name");if(p)s.name=this.getName(p);else{var h=e.querySelector("collab");s.name=h?h.textContent:"N/A"}this.extractContributorProperties(t,e,s),0===s.affiliations.length&&(s.affiliations=t.affiliations),s.competing_interests.length>1&&(s.competing_interests=n.filter(s.competing_interests,function(t){return t.indexOf("no competing")<0})),"author"===e.getAttribute("contrib-type")&&o.nodes.document.authors.push(i),o.create(s),o.show("info",s.id)},this._getEqualContribs=function(t,e,r){var o=[],i=t.xmlDoc.querySelectorAll("xref[rid="+r+"]");return n.each(i,function(t){var n=t.parentNode;n!==e&&o.push(this.getName(n.querySelector("name")))},this),o},this.extractContributorProperties=function(t,e,r){var o=t.doc,i=[],s=[],a=e.querySelectorAll("xref");n.each(a,function(n){if("aff"===n.getAttribute("ref-type")){var a=n.getAttribute("rid"),c=o.getNodeBySourceId(a);c&&(r.affiliations.push(c.id),t.used[a]=!0)}else if("other"===n.getAttribute("ref-type")){console.log("FIXME: please add documentation about using 'other' as indicator for extracting an awardGroup.");var u=t.xmlDoc.getElementById(n.getAttribute("rid"));if(!u)return;var l=u.querySelector("funding-source");if(!l)return;var p=u.querySelector("award-id");p=p?", "+p.textContent:"";var h=l.childNodes[0].textContent;r.fundings.push([h,p].join(""))}else if("corresp"===n.getAttribute("ref-type")){var d=n.getAttribute("rid"),f=t.xmlDoc.getElementById(d);if(!f)return;var g=f.querySelector("email");if(!g)return;r.emails.push(g.textContent)}else if("fn"===n.getAttribute("ref-type")){var y=n.getAttribute("rid"),m=t.xmlDoc.getElementById(y),v=!0;if(m){var b=m.getAttribute("fn-type");switch(b){case"con":r.contribution=m.textContent;break;case"conflict":s.push(m.textContent.trim());break;case"present-address":r.present_address=m.querySelector("p").textContent;break;case"equal":console.log("FIXME: isn't fnElem.getAttribute(id) === fnId?"),i=this._getEqualContribs(t,e,m.getAttribute("id"));break;case"other":console.log("FIXME: isn't fnElem.getAttribute(id) === fnId?"),m.getAttribute("id").indexOf("equal-contrib")>=0?i=this._getEqualContribs(t,e,m.getAttribute("id")):v=!1;break;default:v=!1}v&&(t.used[y]=!0)}}else console.log("Skipping contrib's xref",n.textContent)},this),s.length>1&&(s=n.filter(s,function(t){return t.indexOf("no competing")<0})),r.competing_interests=s;var c=e.querySelector("xref[ref-type=other]");if(c){var u=c.getAttribute("rid"),l=t.xmlDoc.querySelectorAll("#"+u+" contrib");r.members=n.map(l,function(t){return this.getName(t.querySelector("name"))},this)}r.equal_contrib=i,r.competing_interests=s},this.document=function(t,e){var r=t.doc,o=e.querySelector("article");if(!o)throw new i("Expected to find an 'article' element.");return this.article(t,o),this.postProcessAnnotations(t),n.each(r.containers,function(t){t.rebuild()}),r},this.postProcessAnnotations=function(t){for(var e=0;e<t.annotations.length;e++){var n=t.annotations[e];if(n.target){var r=t.doc.getNodeBySourceId(n.target);r&&(n.target=r.id)}t.doc.create(t.annotations[e])}},this.article=function(t,e){var n=t.doc,o=e.querySelector("article-id");n.id=o?o.textContent:r.uuid(),this.extractDefinitions(t,e),this.extractAffilitations(t,e),this.extractContributors(t,e),this.extractCitations(t,e),this.extractFigures(t,e),this.extractCover(t,e),this.extractArticleMeta(t,e),this.extractPublicationInfo(t,e);var i=e.querySelector("body");i&&this.body(t,i),this.enhanceArticle(t,e)},this.extractDefinitions=function(t){var e=t.xmlDoc.querySelectorAll("def-item");n.each(e,function(e){var n=e.querySelector("term"),r=e.querySelector("def"),o=r.id||r.getAttribute("hwp:id")||t.nextId("definition"),i={id:o,type:"definition",title:n.textContent,description:r.textContent};t.doc.create(i),t.doc.show("definitions",i.id)})},this.extractArticleMeta=function(t,e){var n=e.querySelector("article-meta");if(!n)throw new i("Expected element: 'article-meta'");var r=n.querySelectorAll("article-id");this.articleIds(t,r);var o=n.querySelector("title-group");o&&this.titleGroup(t,o);var s=n.querySelectorAll("pub-date");this.pubDates(t,s),this.abstracts(t,n)},this.extractAffilitations=function(t,e){for(var n=e.querySelectorAll("aff"),r=0;r<n.length;r++)this.affiliation(t,n[r])},this.extractContributors=function(t,e){var n=e.querySelector("article-meta contrib-group");n&&this.contribGroup(t,n)},this.extractFigures=function(t,e){for(var n,o=e.querySelector("body"),i=o.querySelectorAll("fig, table-wrap, supplementary-material, media[mimetype=video]"),s=[],a=0;a<i.length;a++){var c=i[a],u=r.dom.getNodeType(c);"fig"===u?(n=this.figure(t,c),n&&s.push(n)):"table-wrap"===u?(n=this.tableWrap(t,c),n&&s.push(n)):"media"===u?(n=this.video(t,c),n&&s.push(n)):"supplementary-material"===u&&(n=this.supplement(t,c),n&&s.push(n))}s.length>0&&this.show(t,s)},this.extractCitations=function(t,e){var n=e.querySelector("ref-list");n&&this.refList(t,n)},this.articleIds=function(t,e){var n=t.doc;n.id=e.length>0?e[0].textContent:r.uuid()},this.titleGroup=function(t,e){var n=t.doc,r=e.querySelector("article-title");r&&(n.title=this.annotatedText(t,r,["document","title"],{ignore:["xref"]}))},this.pubDates=function(t,e){var n=t.doc;if(e.length>0){var r=this.pubDate(t,e[0]);n.created_at=r.date}},this.pubDate=function(t,e){var o=-1,i=-1,s=-1;n.each(r.dom.getChildren(e),function(t){var e=r.dom.getNodeType(t),n=t.textContent;"day"===e?o=parseInt(n,10):"month"===e?i=parseInt(n,10):"year"===e&&(s=parseInt(n,10))},this);var a=new Date(s,i,o);return{date:a}},this.abstracts=function(t,e){var r=e.querySelectorAll("abstract");n.each(r,function(e){this.abstract(t,e)},this)},this.abstract=function(t,e){var n=t.doc,o=[],i=e.querySelector("title"),s={id:t.nextId("heading"),type:"heading",level:1,content:i?i.textContent:"Abstract"};n.create(s),o.push(s),o=o.concat(this.bodyNodes(t,r.dom.getChildren(e),{ignore:["title","object-id"]})),o.length>0&&this.show(t,o)},this.body=function(t,e){var n=t.doc,o={id:t.nextId("heading"),type:"heading",level:1,content:"Main Text"};n.create(o);var i=[o].concat(this.bodyNodes(t,r.dom.getChildren(e)));i.length>0&&this.show(t,i)},this._ignoredBodyNodes={fig:!0,"table-wrap":!0},this._bodyNodes={},this.bodyNodes=function(t,e,o){for(var i,s=[],a=0;a<e.length;a++){var c=e[a],u=r.dom.getNodeType(c);if(this._bodyNodes[u]){var l=this._bodyNodes[u].call(this,t,c);n.isArray(l)?s=s.concat(l):l&&s.push(l)}else this._ignoredBodyNodes[u]||o&&o.ignore&&o.ignore.indexOf(u)>=0?(i=this.ignoredNode(t,c,u),i&&s.push(i)):console.error("Node not yet supported as top-level node: "+u)}return s},this._bodyNodes.p=function(t,e){return this.paragraphGroup(t,e)},this._bodyNodes.sec=function(t,e){return this.section(t,e)},this._bodyNodes.list=function(t,e){return this.list(t,e)},this._bodyNodes["disp-formula"]=function(t,e){return this.formula(t,e)},this._bodyNodes.caption=function(t,e){return this.caption(t,e)},this._bodyNodes["boxed-text"]=function(t,e){return this.boxedText(t,e)},this._bodyNodes["disp-quote"]=function(t,e){return this.boxedText(t,e)},this._bodyNodes.attrib=function(t,e){return this.paragraphGroup(t,e)},this._bodyNodes.comment=function(t,e){return this.comment(t,e)},this.ignoredNode=function(){},this.comment=function(){return null},this.boxedText=function(t,e){var o=t.doc,i=this.bodyNodes(t,r.dom.getChildren(e)),s=t.nextId("box"),a={type:"box",id:s,source_id:e.getAttribute("id"),label:"",children:n.pluck(i,"id")};return o.create(a),a},this.datasets=function(t,e){for(var n=[],o=0;o<e.length;o++){var i=e[o],s=r.dom.getNodeType(i);if("p"===s){var a=i.querySelector("related-object");if(a)n=n.concat(this.indivdata(t,a));else{var c=this.paragraphGroup(t,i);c.length>0&&n.push(c[0].id)}}}return n},this.indivdata=function(t,e){var n=t.doc,o={type:"paragraph",id:t.nextId("paragraph"),children:[]},i={type:"text",id:t.nextId("text"),content:""};o.children.push(i.id);for(var s=r.dom.getChildren(e),a=0;a<s.length;a++){var c,u=s[a],l=r.dom.getNodeType(u);if("name"===l)for(var p=r.dom.getChildren(u),h=0;h<p.length;h++){var d=p[h];if(0===h)c=this.paragraphGroup(t,d),o.children.push(c[0].children[0]);else{var f={type:"text",id:t.nextId("text"),content:", "};n.create(f),o.children.push(f.id),c=this.paragraphGroup(t,d),o.children.push(c[0].children[0])}}else c=this.paragraphGroup(t,u),c&&c[0]&&c[0].children&&o.children.push(c[0].children[0])}return n.create(o),n.create(i),o.id},this.section=function(t,e){t.sectionLevel++;var n=t.doc,o=r.dom.getChildren(e),i=[],s=this.selectDirectChildren(e,"label")[0],a=this.selectDirectChildren(e,"title")[0];if(a||console.error("FIXME: every section should have a title",this.toHtml(e)),i=i.concat(this.bodyNodes(t,o,{ignore:["title","label"]})),i.length>0&&a){var c=t.nextId("heading"),u={id:c,source_id:e.getAttribute("id"),type:"heading",level:t.sectionLevel,content:a?this.annotatedText(t,a,[c,"content"]):""};s&&(u.label=s.textContent),u.content.length>0&&(n.create(u),i.unshift(u))}else 0===i.length&&console.info("NOTE: skipping section without content:",a?a.innerHTML:"no title");return t.sectionLevel--,i},this.ignoredParagraphElements={comment:!0,"supplementary-material":!0,fig:!0,"fig-group":!0,"table-wrap":!0,media:!0},this.acceptedParagraphElements={"boxed-text":{handler:"boxedText"},list:{handler:"list"},"disp-formula":{handler:"formula"}},this.inlineParagraphElements={"inline-graphic":!0,"inline-formula":!0},this.segmentParagraphElements=function(t){for(var e=[],o="",i=new r.dom.ChildNodeIterator(t);i.hasNext();){var s=i.next(),a=r.dom.getNodeType(s);this.ignoredParagraphElements[a]||("text"===a||this.isAnnotation(a)||this.inlineParagraphElements[a]?("paragraph"!==o&&(e.push({handler:"paragraph",nodes:[]}),o="paragraph"),n.last(e).nodes.push(s)):(this.acceptedParagraphElements[a]&&e.push(n.extend({node:s},this.acceptedParagraphElements[a])),o=a))}return e},this.paragraphGroup=function(t,e){for(var n=[],r=this.segmentParagraphElements(e),o=0;o<r.length;o++){var i,s=r[o];"paragraph"===s.handler?(i=this.paragraph(t,s.nodes),i&&(i.source_id=e.getAttribute("id"))):i=this[s.handler](t,s.node),i&&n.push(i)}return n},this.paragraph=function(t,e){var o=t.doc;t.skipWS=!0;for(var i={id:t.nextId("paragraph"),type:"paragraph",children:null},s=[],a=new r.dom.ChildNodeIterator(e);a.hasNext();){var c=a.next(),u=r.dom.getNodeType(c);if("text"===u||this.isAnnotation(u)){var l={id:t.nextId("text"),type:"text",content:null};t.stack.push({path:[l.id,"content"]});var p=this._annotatedText(t,a.back(),{offset:0,breakOnUnknown:!0});p.length>0&&(l.content=p,o.create(l),s.push(l)),t.stack.pop()}else if("inline-graphic"===u){var h=c.getAttribute("xlink:href"),d={id:t.nextId("image"),type:"image",url:this.resolveURL(t,h)};o.create(d),s.push(d)}else if("inline-formula"===u){var f=this.formula(t,c,"inline");f&&s.push(f)}}return 0===s.length?null:(i.children=n.map(s,function(t){return t.id}),o.create(i),i)},this.list=function(t,e){var n=t.doc,o={id:t.nextId("list"),source_id:e.getAttribute("id"),type:"list",items:[],ordered:!1};"ordered"===e.getAttribute("list-type")&&(o.ordered=!0);for(var i=e.querySelectorAll("list-item"),s=0;s<i.length;s++)for(var a=i[s],c=this.bodyNodes(t,r.dom.getChildren(a)),u=0;u<c.length;u++)o.items.push(c[u].id);return n.create(o),o},this.figure=function(t,e){var n=t.doc,r={type:"figure",id:t.nextId("figure"),source_id:e.getAttribute("id"),label:"Figure",url:"",caption:null},o=e.querySelector("label");o&&(r.label=this.annotatedText(t,o,[r.id,"label"]));var i=e.querySelector("caption");if(i){var s=this.caption(t,i);s&&(r.caption=s.id)}var a=e.querySelector("attrib");return a&&(r.attrib=a.textContent),this.enhanceFigure(t,r,e),n.create(r),r},this.supplement=function(t,e){var n=t.doc,r=e.querySelector("label"),o=e.querySelector("media"),i=o?o.getAttribute("xlink:href"):null,s=e.querySelector("object-id[pub-id-type='doi']");s=s?"http://dx.doi.org/"+s.textContent:"";var a={id:t.nextId("supplement"),source_id:e.getAttribute("id"),type:"supplement",label:r?r.textContent:"",url:i,caption:null},c=e.querySelector("caption");
if(c){var u=this.caption(t,c);u&&(a.caption=u.id)}return this.enhanceSupplement(t,a,e),n.create(a),a},this.caption=function(t,e){var r=t.doc,o={id:t.nextId("caption"),source_id:e.getAttribute("id"),type:"caption",title:"",children:[]},i=e.querySelector("title");if(i){var s=this.paragraph(t,i);s&&(o.title=s.id)}var a=[],c=e.querySelectorAll("p");return n.each(c,function(n){if(n.parentNode===e){var r=this.paragraph(t,n);r&&a.push(r.id)}},this),o.children=a,r.create(o),o},this.video=function(t,e){var n=t.doc,r=e.querySelector("label").textContent,o=t.nextId("video"),i={id:o,source_id:e.getAttribute("id"),type:"video",label:r,title:"",caption:null,poster:""},s=e.querySelector("caption");if(s){var a=this.caption(t,s);a&&(i.caption=a.id)}return this.enhanceVideo(t,i,e),n.create(i),i},this.tableWrap=function(t,e){var n=t.doc,r=e.querySelector("label"),o={id:t.nextId("html_table"),source_id:e.getAttribute("id"),type:"html_table",title:"",label:r?r.textContent:"Table",content:"",caption:null,footers:[]},i=e.querySelector("table");return i&&(o.content=this.toHtml(i)),this.extractTableCaption(t,o,e),this.enhanceTable(t,o,e),n.create(o),o},this.extractTableCaption=function(t,e,n){var r=n.querySelector("caption");if(r){var o=this.caption(t,r);o&&(e.caption=o.id)}else console.error("caption node not found for",n)},this._getFormulaData=function(t){for(var e=[],n=t.firstElementChild;n;n=n.nextElementSibling){var o=r.dom.getNodeType(n);switch(o){case"graphic":case"inline-graphic":e.push({format:"image",data:n.getAttribute("xlink:href")});break;case"svg":e.push({format:"svg",data:this.toHtml(n)});break;case"mml:math":case"math":e.push({format:"mathml",data:this.mmlToHtmlString(n)});break;case"tex-math":e.push({format:"latex",data:n.textContent});break;case"label":break;default:console.error("Unsupported formula element of type "+o)}}return e},this.formula=function(t,e,n){var r=t.doc,o={id:t.nextId("formula"),source_id:e.getAttribute("id"),type:"formula",label:"",inline:!!n,data:[],format:[]},i=e.querySelector("label");i&&(o.label=i.textContent);for(var s=this._getFormulaData(e,n),a=0;a<s.length;a++)o.format.push(s[a].format),o.data.push(s[a].data);return r.create(o),o},this.citationTypes={"mixed-citation":!0,"element-citation":!0},this.refList=function(t,e){for(var n=e.querySelectorAll("ref"),r=0;r<n.length;r++)this.ref(t,n[r])},this.ref=function(t,e){for(var n=r.dom.getChildren(e),o=0;o<n.length;o++){var i=n[o],s=r.dom.getNodeType(i);this.citationTypes[s]?this.citation(t,e,i):"label"===s||console.error("Not supported in 'ref': ",s)}},this.citation=function(t,e,n){var r,o,i=t.doc,s=t.nextId("article_citation"),a=n.querySelector("person-group");if(!a)return void console.error("FIXME: there is one of those 'mixed-citation' without any structure. Skipping ...",n);r={id:s,source_id:e.getAttribute("id"),type:"citation",title:"N/A",label:"",authors:[],doi:"",source:"",volume:"",fpage:"",lpage:"",citation_urls:[]};var c=a.querySelectorAll("name");for(o=0;o<c.length;o++)r.authors.push(this.getName(c[o]));var u=a.querySelectorAll("collab");for(o=0;o<u.length;o++)r.authors.push(u[o].textContent);var l=n.querySelector("source");l&&(r.source=l.textContent);var p=n.querySelector("article-title");if(p)r.title=this.annotatedText(t,p,[s,"title"]);else{var h=n.querySelector("comment");h?r.title=this.annotatedText(t,h,[s,"title"]):l?r.title=this.annotatedText(t,l,[s,"title"]):console.error("FIXME: this citation has no title",n)}var d=n.querySelector("volume");d&&(r.volume=d.textContent);var f=n.querySelector("publisher-loc");f&&(r.publisher_location=f.textContent);var g=n.querySelector("publisher-name");g&&(r.publisher_name=g.textContent);var y=n.querySelector("fpage");y&&(r.fpage=y.textContent);var m=n.querySelector("lpage");m&&(r.lpage=m.textContent);var v=n.querySelector("year");v&&(r.year=v.textContent);var b=e.querySelector("label");b&&(r.label=b.textContent);var w=n.querySelector("pub-id[pub-id-type='doi'], ext-link[ext-link-type='doi']");return w&&(r.doi="http://dx.doi.org/"+w.textContent),i.create(r),i.show("citations",s),r},this.back=function(){return null},this.createAnnotation=function(t,e,r,o){if(r!==o){var i=e.tagName.toLowerCase(),s={type:"annotation",path:n.last(t.stack).path,range:[r,o]};this.addAnnotationData(t,s,e,i),this.enhanceAnnotationData(t,s,e,i),s.id=t.nextId(s.type),t.annotations.push(s)}},this.addAnnotationData=function(t,e,n,r){if(e.type=this._annotationTypes[r]||"annotation","xref"===r)this.addAnnotationDataForXref(t,e,n);else if("ext-link"===r||"uri"===r){e.url=n.getAttribute("xlink:href");var o=n.getAttribute("ext-link-type")||"";"uri"!==r&&"uri"!==o.toLowerCase()||/^\w+:\/\//.exec(e.url)||/^\//.exec(e.url)?"doi"===o.toLowerCase()&&(e.url=["http://dx.doi.org/",e.url].join("")):e.url="http://"+e.url}else if("email"===r)e.url="mailto:"+n.textContent.trim();else if("inline-graphic"===r)e.url=n.getAttribute("xlink:href");else if("inline-formula"===r){var i=this.formula(t,n,"inline");e.target=i.id}},this.addAnnotationDataForXref=function(t,e,n){var r=n.getAttribute("ref-type"),o=n.getAttribute("rid");e.type=this._refTypeMapping[r]||"cross_reference",o&&(e.target=o.split(" ")[0])},this.annotatedText=function(t,e,n,o){o=o||{},t.stack.push({path:n,ignore:o.ignore});var i=new r.dom.ChildNodeIterator(e),s=this._annotatedText(t,i,o);return t.stack.pop(),s},this._annotatedText=function(t,e,n){for(var o="",i=void 0===n.offset?0:n.offset,s=!!n.nested,a=!!n.breakOnUnknown;e.hasNext();){var c=e.next();if(c.nodeType===Node.TEXT_NODE){var u=t.acceptText(c.textContent);o+=u,i+=u.length}else{var l,p=r.dom.getNodeType(c);if(this.isAnnotation(p)){if(t.top().ignore.indexOf(p)<0){var h=i;l=this._annotationTextHandler[p]?this._annotationTextHandler[p].call(this,t,c,p,i):this._getAnnotationText(t,c,p,i),o+=l,i+=l.length,t.ignoreAnnotations||this.createAnnotation(t,c,h,i)}}else if(a){if(!s){e.back();break}console.error("Node not yet supported in annoted text: "+p)}else t.top().ignore.indexOf(p)<0&&(l=this._getAnnotationText(t,c,p,i),o+=l,i+=l.length)}}return o},this._annotationTextHandler={},this._getAnnotationText=function(t,e,n,o){var i=new r.dom.ChildNodeIterator(e),s=this._annotatedText(t,i,{offset:o,nested:!0});return s},this._annotationTextHandler["ext-link"]=function(t,e,n,r){var o=this._getAnnotationText(t,e,r);return"ext-link"===n&&e.getAttribute("xlink:href")===o.trim()&&(o=this.shortenLinkLabel(t,o)),o},this._annotationTextHandler["inline-formula"]=function(t){return t.acceptText("{{inline-formula}}")},this.shortenLinkLabel=function(t,e){var n=50,r=10;if(e.length>n){var o=/((?:\w+:\/\/)?[\/]?[^\/]+[\/]?)(.*)/.exec(e);if(o){var i=o[1]||"",s=o[2]||"";if(i.length>n-r)e=i.substring(0,n-r)+"..."+s.substring(s.length-r-3);else{var a=Math.max(n-i.length-3,r-3);e=i+"..."+s.substring(s.length-a)}}else e=e.substring(0,n-r)+"..."+e.substring(e.length-r-3)}return e},this.getBaseURL=function(t){var e=t.xmlDoc.querySelector("article").getAttribute("xml:base");return e||t.options.baseURL},this.enhanceArticle=function(){},this.enhanceCover=function(){},this.enhanceFigure=function(t,e,n){var r=n.querySelector("graphic"),o=r.getAttribute("xlink:href");e.url=this.resolveURL(t,o)},this.enhancePublicationInfo=function(){},this.enhanceSupplement=function(){},this.enhanceTable=function(){},this.enhanceVideo=function(t,e,n){var r,o=(n.querySelector("media")||n,n.getAttribute("xlink:href"));if(o.match(/http:/)){var i=o.lastIndexOf(".");return r=o.substring(0,i),e.url=r+".mp4",e.url_ogv=r+".ogv",e.url_webm=r+".webm",void(e.poster=r+".png")}var s=this.getBaseURL(t);r=o.split(".")[0],e.url=s+r+".mp4",e.url_ogv=s+r+".ogv",e.url_webm=s+r+".webm",e.poster=s+r+".png"},this.resolveURL=function(t,e){return e.match(/http:/)?e:[t.options.baseURL,e].join("")},this.viewMapping={box:"content",supplement:"figures",figure:"figures",html_table:"figures",video:"figures"},this.enhanceAnnotationData=function(){},this.showNode=function(t,e){var n=this.viewMapping[e.type]||"content";t.doc.show(n,e.id)}},s.State=function(t,e,r){var o=this;this.xmlDoc=e,this.doc=r,this.options=t.options,this.annotations=[],this.stack=[],this.sectionLevel=1,this.affiliations=[];var i={};this.nextId=function(t){return i[t]=i[t]||0,i[t]++,t+"_"+i[t]},this.used={};var s=/^\s+/g,a=/^\s*/g,c=/\s+$/g,u=/\s+/g,l=" ",p=/[\t\n\r]+/g;this.lastChar="",this.skipWS=!1,this.acceptText=function(t){return this.options.TRIM_WHITESPACES?(t=t.replace(p,""),t=this.lastChar===l||this.skipWS?t.replace(a,""):t.replace(s,l),this.skipWS=!1,t=t.replace(c,l),this.options.REMOVE_INNER_WS&&(t=t.replace(u,l)),this.lastChar=t[t.length-1]||this.lastChar,t):t},this.top=function(){var t=n.last(o.stack);return t=t||{},t.ignore=t.ignore||[],t}},s.prototype=new s.Prototype,s.prototype.constructor=s,s.DefaultOptions={TRIM_WHITESPACES:!0,REMOVE_INNER_WS:!0},e.exports=s},{"lens-article":4,"substance-util":167,underscore:175}],122:[function(t,e){e.exports=t("./src/lens")},{"./src/lens":125}],123:[function(t,e){var n=t("./panels/container_panel"),r=new n({type:"resource",name:"figures",container:"figures",title:"Figures",icon:"fa-picture-o",references:["figure_reference"],zoom:!0}),o=new n({type:"resource",name:"citations",container:"citations",title:"References",icon:"fa-link",references:["citation_reference"]}),i=new n({type:"resource",name:"definitions",container:"definitions",title:"Glossary",icon:"fa-book",references:["definition_reference"]}),s=new n({type:"resource",name:"info",container:"info",title:"Info",icon:"fa-info",references:["contributor_reference"]});e.exports=[r,o,i,s]},{"./panels/container_panel":129}],124:[function(t,e){var n=t("./workflows/toggle_resource_reference"),r=t("./workflows/follow_crossrefs"),o=t("./workflows/jump_to_top"),i=[new n,new r,new o];e.exports=i},{"./workflows/follow_crossrefs":145,"./workflows/jump_to_top":146,"./workflows/toggle_resource_reference":147}],125:[function(t,e){"use strict";var n=t("substance-application"),r=t("./lens_controller"),o=t("lens-converter"),i=t("lens-article"),s=t("./panels/resource_panel_viewfactory"),a=t("./reader_controller"),c=t("./reader_view"),u=t("./panels/panel"),l=t("./panels/panel_controller"),p=t("./panels/panel_view"),h=t("./panels/container_panel"),d=t("./panels/container_panel_controller"),f=t("./panels/container_panel_view"),g=t("./workflows/workflow"),y=t("./default_panels"),m=t("./default_workflows"),v=function(t){t=t||{},t.routes=t.routes||this.getRoutes(),t.panels=t.panels||this.getPanels(),t.workflows=t.workflows||this.getWorkflows(),t.converters=this.getConverters(t.converterOptions),n.call(this,t),this.controller=t.controller||this.createController(t)};v.Prototype=function(){this.start=function(){n.prototype.start.call(this)},this.render=function(){this.view=this.controller.createView(),this.$el.html(this.view.render().el)},this.getRoutes=function(){return v.getDefaultRoutes()},this.getPanels=function(){return v.getDefaultPanels()},this.getWorkflows=function(){return v.getDefaultWorkflows()},this.getConverters=function(t){return[v.getDefaultConverter(t)]},this.createController=function(t){return new r(t)}},v.Prototype.prototype=n.prototype,v.prototype=new v.Prototype,v.prototype.constructor=v,v.DEFAULT_ROUTES=[{route:":context/:focussedNode/:fullscreen",name:"document-focussed-fullscreen",command:"openReader"},{route:":context/:focussedNode",name:"document-focussed",command:"openReader"},{route:":context",name:"document-context",command:"openReader"},{route:"url/:url",name:"document",command:"openReader"},{route:"",name:"document",command:"openReader"}],v.getDefaultRoutes=function(){return v.DEFAULT_ROUTES},v.getDefaultPanels=function(){return y.slice(0)},v.getDefaultWorkflows=function(){return m.slice(0)},v.getDefaultConverter=function(t){return new o(t)},v.Article=i,v.ReaderController=a,v.ReaderView=c,v.Controller=r,v.LensController=r,v.Panel=u,v.PanelController=l,v.PanelView=p,v.ContainerPanel=h,v.ContainerPanelController=d,v.ContainerPanelView=f,v.ResourcePanelViewFactory=s,v.Workflow=g,e.exports=v},{"./default_panels":123,"./default_workflows":124,"./lens_controller":126,"./panels/container_panel":129,"./panels/container_panel_controller":130,"./panels/container_panel_view":131,"./panels/panel":138,"./panels/panel_controller":139,"./panels/panel_view":140,"./panels/resource_panel_viewfactory":141,"./reader_controller":143,"./reader_view":144,"./workflows/workflow":148,"lens-article":4,"lens-converter":120,"substance-application":149}],126:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=t("substance-application").Controller,i=t("./lens_view"),s=t("./reader_controller"),a=t("lens-article"),c=t("lens-converter"),u=function(t){o.call(this),this.config=t,this.Article=t.articleClass||a,this.converter=t.converter,this.converters=t.converters,this.converterOptions=n.extend({},c.DefaultOptions,t.converterOptions),this.on("open:reader",this.openReader)};u.Prototype=function(){this.createView=function(){var t=new i(this);return this.view=t,t},this.importXML=function(t){var e=new DOMParser,n=e.parseFromString(t,"text/xml"),r=this.convertDocument(n);this.createReader(r,{panel:"toc"})},this.updatePath=function(t){var e=[];e.push(t.panel),t.focussedNode&&e.push(t.focussedNode),t.fullscreen&&e.push("fullscreen"),window.app.router.navigate(e.join("/"),{trigger:!1,replace:!1})},this.createReader=function(t,e){var n=this;this.reader=new s(t,e,this.config),this.reader.on("state-changed",function(){n.updatePath(n.reader.state)}),this.modifyState({context:"reader"})},this.convertDocument=function(t){for(var e,n=0;!e&&n<this.converters.length;){var r=this.converters[n];r.test(t,this.config.document_url)&&(e=r.import(t)),n+=1}if(!e)throw new Error("No suitable converter found for this document",t);return e},this.openReader=function(t,e,n){var r=this,o={panel:t||"toc",focussedNode:e,fullscreen:!!n};if(this.reader)this.reader.modifyState(o);else if("lens_article.xml"===this.config.document_url){var i=this.Article.describe();r.createReader(i,o)}else this.trigger("loading:started","Loading article"),$.get(this.config.document_url).done(function(t){var e;$.isXMLDoc(t)?e=r.convertDocument(t):("string"==typeof t&&(t=$.parseJSON(t)),e=r.Article.fromSnapshot(t)),"toc"===o.panel&&e.getHeadings().length<=2&&(o.panel="info"),r.createReader(e,o)}).fail(function(t){r.view.startLoading("Error during loading. Please try again."),console.error(t)})}},u.Prototype.prototype=o.prototype,u.prototype=new u.Prototype,n.extend(u.prototype,r.Events),e.exports=u},{"./lens_view":128,"./reader_controller":143,"lens-article":4,"lens-converter":120,"substance-application":149,"substance-util":167,underscore:175}],127:[function(t,e){var n=t("underscore"),r=t("substance-application"),o=r.View,i=function(t,e){o.call(this,e),this.docCtrl=t,this.options=e,this.document=t.getDocument(),this.viewFactory=this.options.viewFactory?this.options.viewFactory:new this.document.constructor.ViewFactory(this.document.nodeTypes),this.$el.addClass("surface"),this.$nodes=$("<div>").addClass("nodes"),this.$el.append(this.$nodes)};i.Prototype=function(){this.render=function(){return this.$nodes.html(this.build()),this},this.findNodeView=function(t){return this.el.querySelector("*[data-id="+t+"]")},this.build=function(){var t=document.createDocumentFragment();n.each(this.nodes,function(t){t.dispose()}),this.nodes={};var e=this.docCtrl.container.getTopLevelNodes();return n.each(e,function(e){var n=this.renderNodeView(e);this.nodes[e.id]=n,t.appendChild(n.el)},this),t},this.renderNodeView=function(t){var e=this.viewFactory.createView(t,{topLevel:!0});return e.render(),e}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,i.prototype.constructor=i,e.exports=i},{"substance-application":149,underscore:175}],128:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").View,o=t("substance-application").$$,i=function(t){r.call(this),this.controller=t,this.$el.attr({id:"container"}),this.listenTo(this.controller,"state-changed",this.onStateChanged),this.listenTo(this.controller,"loading:started",this.startLoading),$(document).on("dragover",function(){return!1}),$(document).on("ondragend",function(){return!1}),$(document).on("drop",this.handleDroppedFile.bind(this))};i.Prototype=function(){this.handleDroppedFile=function(){var t=this.controller,e=event.dataTransfer.files,n=e[0],r=new FileReader;return r.onload=function(e){t.importXML(e.target.result)},r.readAsText(n),!1},this.onStateChanged=function(){var t=this.controller.state;"reader"===t.context?this.openReader():console.log("Unknown application state: "+t)},this.startLoading=function(t){t||(t="Loading article"),$(".spinner-wrapper .message").html(t),$("body").addClass("loading")},this.stopLoading=function(){$("body").removeClass("loading")},this.openReader=function(){var t=this.controller.reader.createView(),e=this;e.replaceMainView("reader",t),e.startLoading("Typesetting"),this.$("#main").css({opacity:0}),n.delay(function(){e.stopLoading(),e.$("#main").css({opacity:1})},1e3)},this.replaceMainView=function(t,e){$("body").removeClass().addClass("current-view "+t),this.mainView&&this.mainView!==e&&this.mainView.dispose(),this.mainView=e,this.$("#main").html(e.render().el)},this.render=function(){return this.el.innerHTML="",this.el.appendChild(o(".browser-not-supported",{text:"Sorry, your browser is not supported.",style:"display: none;"})),this.el.appendChild(o(".spinner-wrapper",{children:[o(".spinner"),o(".message",{html:"Loading article"})]})),this.el.appendChild(o("#main")),this},this.dispose=function(){this.stopListening(),this.mainView&&this.mainView.dispose()}},i.Prototype.prototype=r.prototype,i.prototype=new i.Prototype,e.exports=i},{"substance-application":149,underscore:175}],129:[function(t,e){"use strict";var n=t("./panel"),r=t("./container_panel_controller"),o=function(t){n.call(this,t)};o.Prototype=function(){this.createController=function(t){return new r(t,this.config)}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"./container_panel_controller":130,"./panel":138}],130:[function(t,e){"use strict";var n=t("substance-document"),r=t("./panel_controller"),o=t("./resource_panel_viewfactory"),i=t("./container_panel_view"),s=function(t,e){r.call(this,t,e),this.docCtrl=new n.Controller(t,{view:e.container})};s.Prototype=function(){this.createView=function(){var t,e=this.getDocument();if("resource"===this.config.type)t=this.config.createViewFactory?this.config.createViewFactory(e,this.config):new o(e.nodeTypes,this.config);else{var n=e.constructor.ViewFactory;t=new n(e.nodeTypes,this.config)}return new i(this,t,this.config)},this.getContainer=function(){return this.docCtrl.getContainer()}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"./container_panel_view":131,"./panel_controller":139,"./resource_panel_viewfactory":141,"substance-document":160}],131:[function(t,e){"use strict";var n=t("underscore"),r=t("./surface_scrollbar"),o=t("../lens_surface"),i=t("./panel_view"),s=function(t,e,s){i.call(this,t,s),this.surface=new o(t.docCtrl,{editable:!1,viewFactory:e}),this.docCtrl=t.docCtrl,this.scrollbar=new r(this.surface),this._onScroll=n.bind(this.onScroll,this),this.surface.$el.on("scroll",this._onScroll),this.surface.$el.addClass("resource-view").addClass(s.container),this.el.appendChild(this.surface.el),this.el.appendChild(this.scrollbar.el),this.$activeResource=null};s.Prototype=function(){this.render=function(){return 0===this.getContainer().getLength()?(this.hideToggle(),this.hide()):(this.surface.render(),this.scrollbar.render()),this},this.getContainer=function(){return this.docCtrl.container},this.onScroll=function(){this.scrollbar.onScroll()},this.hasScrollbar=function(){return!0},this.scrollTo=function(t){var e=this.findNodeView(t);if(e){var n,r=$(e),o=($(window).height(),this.surface.$el.height());n=this.surface.$el.scrollTop();var i,s=r.offset().top,a=r.height();if(s>0&&o>s+a||s>=0&&o>s)return;i=n+s,this.surface.$el.scrollTop(i),this.scrollbar.update()}else console.info("ContainerPanelView.scrollTo(): Unknown resource '%s'",t)},this.findNodeView=function(t){return this.surface.findNodeView(t)},this.addHighlight=function(t,e){i.prototype.addHighlight.call(this,t,e);var n=this.getDocument().get(t);n&&this.scrollbar.addHighlight(t,e+" "+n.type)},this.removeHighlights=function(){i.prototype.removeHighlights.call(this),this.scrollbar.removeHighlights(),this.scrollbar.update()},this.update=function(){this.scrollbar.update()},this.hide=function(){this.hidden||i.prototype.hide.call(this)},this.show=function(){this.scrollbar.update(),i.prototype.show.call(this)}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,e.exports=s},{"../lens_surface":127,"./panel_view":140,"./surface_scrollbar":142,underscore:175}],132:[function(t,e){"use strict";var n=t("../container_panel"),r=t("./content_panel_controller"),o=function(){n.call(this,{name:"content",type:"document",container:"content",label:"Content",title:"Content",icon:"fa-align-left"})};o.Prototype=function(){this.createController=function(t){return new r(t,this.config)}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"../container_panel":129,"./content_panel_controller":133}],133:[function(t,e){"use strict";var n=t("../container_panel_controller"),r=t("./content_panel_view"),o=function(t,e){n.call(this,t,e)};o.Prototype=function(){this.createView=function(){if(!this.view){var t=this.getDocument(),e=t.constructor.ViewFactory,n=new e(t.nodeTypes,this.config);this.view=new r(this,n,this.config)}return this.view}},o.Prototype.prototype=n.prototype,o.prototype=new o.Prototype,e.exports=o},{"../container_panel_controller":130,"./content_panel_view":134}],134:[function(t,e){"use strict";var n=t("underscore"),r=t("../container_panel_view"),o=t("./toc_panel_view"),i=t("substance-data"),s=(i.Graph.Index,0),a=function(t,e,i){r.call(this,t,e,i),this.tocView=new o(t,e,n.extend({},i,{type:"resource",name:"toc"})),this._onTocItemSelected=n.bind(this.onTocItemSelected,this),this.resources=t.getDocument().addIndex("referenceByTarget",{types:["resource_reference"],property:"target"}),this.tocView.toc.on("toc-item-selected",this._onTocItemSelected),this.$el.addClass("document")};a.Prototype=function(){this.dispose=function(){this.tocView.toc.off("toc-item-selected",this._onTocItemSelected),this.stopListening()},this.getTocView=function(){return this.tocView},this.onScroll=function(){var t=this.surface.$el.scrollTop();this.scrollbar.update(),this.markActiveHeading(t)},this.onTocItemSelected=function(t){var e=this.findNodeView(t);if(e){var n=$(e).position().top+s;this.surface.$el.scrollTop(n)}},this.markActiveHeading=function(t){var e=$(".nodes").height(),r=this.getDocument().getHeadings();if(0!==r.length){var o=n.first(r).id;this.$(".content-node.heading").each(function(){t>=$(this).position().top+s&&(o=this.dataset.id)}),t+this.$el.height()>=e&&(o=n.last(r).id),this.tocView.setActiveNode(o)}},this.markReferencesTo=function(t){var e=this.resources.get(t);n.each(e,function(t){$(this.findNodeView(t.id)).addClass("active")},this)},this.removeHighlights=function(){r.prototype.removeHighlights.call(this),this.$el.find(".content-node.active").removeClass("active"),this.$el.find(".annotation.active").removeClass("active")}},a.Prototype.prototype=r.prototype,a.prototype=new a.Prototype,a.prototype.constructor=a,e.exports=a},{"../container_panel_view":131,"./toc_panel_view":136,"substance-data":155,underscore:175}],135:[function(t,e){e.exports=t("./content_panel")},{"./content_panel":132}],136:[function(t,e){"use strict";var n=t("./toc_view"),r=t("../panel_view"),o=function(t,e,o){r.call(this,t,o),this.toc=new n(t.getDocument(),e)};o.Prototype=function(){this.render=function(){return this.el.appendChild(this.toc.render().el),this},this.setActiveNode=function(t){this.toc.setActiveNode(t)},this.onToggle=function(t){this.trigger("toggle","toc"),t.preventDefault(),t.stopPropagation()}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,o.prototype.constructor=o,e.exports=o},{"../panel_view":140,"./toc_view":137}],137:[function(t,e){"use strict";var n=t("substance-application").View,r=(t("substance-application").$$,t("substance-data")),o=(r.Graph.Index,t("underscore")),i=function(t,e){n.call(this),this.doc=t,this.viewFactory=e,this.$el.addClass("toc")};i.Prototype=function(){this.render=function(){var t=-1,e=this.doc.getTocNodes();return e.length<2?this:(o.each(e,function(e){var n=this.viewFactory.createView(e),r=e.getLevel();-1===r?r=t+1:t=r;var i=n.renderTocItem(),s=$(i);i.id="toc_"+e.id,s.addClass("heading-ref"),s.addClass("level-"+r),s.click(o.bind(this.onClick,this,e.id)),this.el.appendChild(i)},this),this)},this.setActiveNode=function(t){this.$(".heading-ref.active").removeClass("active"),this.$("#toc_"+t).addClass("active")},this.onClick=function(t){this.trigger("toc-item-selected",t)}},i.Prototype.prototype=n.prototype,i.prototype=new i.Prototype,e.exports=i},{"substance-application":149,"substance-data":155,underscore:175}],138:[function(t,e){"use strict";var n=function(t){this.config=t,this.config.label=t.title};n.Prototype=function(){this.createController=function(){throw new Error("this method is abstract")},this.getName=function(){return this.config.name},this.getConfig=function(){return this.config}},n.prototype=new n.Prototype,n.prototype.constructor=n,e.exports=n},{}],139:[function(t,e){"use strict";var n=t("substance-application").Controller,r=(t("underscore"),t("substance-util"),function(t,e){this.document=t,this.config=e});r.Prototype=function(){n.prototype;this.createView=function(){throw new Error("this is an abstract method")},this.getConfig=function(){return this.config},this.getName=function(){return this.config.name},this.getDocument=function(){return this.document}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"substance-application":149,"substance-util":167,underscore:175}],140:[function(t,e){var n=t("underscore"),r=t("substance-application"),o=r.$$,i=r.View,s=function(t,e){i.call(this),this.controller=t,this.config=e,this.doc=t.getDocument(),this.name=e.name,this.toggleEl=o("a.context-toggle."+this.name,{title:this.config.title,html:'<i class="fa '+this.config.icon+'"></i><div class="label">'+this.config.label+"</div><span> "+this.config.label+"</span>"}),this.$toggleEl=$(this.toggleEl),this.$el.addClass("panel").addClass(this.name),"resource"===this.config.type&&this.$el.addClass("resource-view"),this._onToggle=n.bind(this.onToggle,this),this._onToggleResource=n.bind(this.onToggleResource,this),this._onToggleResourceReference=n.bind(this.onToggleResourceReference,this),this._onToggleFullscreen=n.bind(this.onToggleFullscreen,this),this.$toggleEl.click(this._onToggle),this.$el.on("click",".action-toggle-resource",this._onToggleResource),this.$el.on("click",".toggle-fullscreen",this._onToggleFullscreen),this.$el.on("click",".annotation.resource-reference",this._onToggleResourceReference),this.highlightedNodes=[]};s.Prototype=function(){this.dispose=function(){this.$toggleEl.off("click",this._onClick),this.$el.off("scroll",this._onScroll),this.$el.off("click",".a.action-toggle-resource",this._onToggleResource),this.$el.off("click",".a.toggle-fullscreen",this._onToggleFullscreen),this.$el.off("click",".annotation.reference",this._onToggleResourceReference),this.stopListening()},this.onToggle=function(t){this.trigger("toggle",this.name),t.preventDefault(),t.stopPropagation()},this.getToggleControl=function(){return this.toggleEl},this.hasScrollbar=function(){return!1},this.show=function(){this.$el.removeClass("hidden"),this.hidden=!1},this.hide=function(){this.hidden||(this.$el.addClass("hidden"),this.$toggleEl.removeClass("active"),this.hidden=!0)},this.isHidden=function(){return this.hidden},this.activate=function(){this.show(),$("#main .article")[0].dataset.context=this.name,this.$toggleEl.addClass("active")},this.addHighlight=function(t,e){var n=this.findNodeView(t);if(n){var r=$(n);r.addClass(e),this.highlightedNodes.push({$el:r,cssClass:e})}},this.removeHighlights=function(){for(var t=0;t<this.highlightedNodes.length;t++){var e=this.highlightedNodes[t];e.$el.removeClass(e.cssClass)}this.highlightedNodes=[]},this.showToggle=function(){this.$toggleEl.removeClass("hidden")},this.hideToggle=function(){this.$toggleEl.addClass("hidden")},this.getDocument=function(){return this.doc},this.findNodeView=function(t){return this.el.querySelector("*[data-id="+t+"]")},this.onToggleResource=function(t){t.preventDefault(),t.stopPropagation();var e=$(t.currentTarget).parents(".content-node")[0],n=e.dataset.id;this.trigger("toggle-resource",this.name,n,e)},this.onToggleResourceReference=function(t){t.preventDefault(),t.stopPropagation();var e=t.currentTarget,n=t.currentTarget.dataset.id;this.trigger("toggle-resource-reference",this.name,n,e)},this.onToggleFullscreen=function(t){t.preventDefault(),t.stopPropagation();var e=$(t.currentTarget).parents(".content-node")[0],n=e.dataset.id;this.trigger("toggle-fullscreen",this.name,n,e)}},s.Prototype.prototype=i.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,e.exports=s},{"substance-application":149,underscore:175}],141:[function(t,e){var n=t("lens-article").ViewFactory,r=function(t,e){n.call(this,t),this.options=e||{},void 0===this.options.header&&(this.options.header=!0),void 0===this.options.zoom&&(this.options.zoom=r.enableZoom)};r.Prototype=function(){this.createView=function(t,e,n){e=e||{};var r=this.getNodeViewClass(t,n);e.topLevel&&r.prototype.isResourceView&&this.options.header&&(e.header=!0,r.prototype.isZoomable&&this.options.zoom&&(e.zoom=!0));var o=new r(t,this,e);return o}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.enableZoom=!1,e.exports=r},{"lens-article":4}],142:[function(t,e){"use strict";var n=t("substance-application").View,r=t("substance-application").$$,o=t("underscore"),i=function(t){n.call(this),this.surface=t,this.$nodes=this.surface.$nodes,this.$el.addClass("surface-scrollbar"),this.$el.addClass(t.docCtrl.getContainer().id),this.overlays=[],o.bindAll(this,"mouseDown","mouseUp","mouseMove","updateVisibleArea"),this.$el.mousedown(this.mouseDown),$(window).mousemove(this.mouseMove),$(window).mouseup(this.mouseUp)};i.Prototype=function(){this.render=function(){var t=this.$nodes.height(),e=this.surface.$el.height();return this.factor=t/e,this.visibleArea=r(".visible-area"),this.scrollTop=this.surface.$el.scrollTop(),this.el.innerHTML="",this.el.appendChild(this.visibleArea),this.updateVisibleArea(),this},this.updateVisibleArea=function(){$(this.visibleArea).css({top:this.scrollTop/this.factor,height:this.surface.$el.height()/this.factor})},this.addOverlay=function(t){var e=$("<div>").addClass("node overlay");return this.overlays.push({el:t,$overlay:e}),this.$el.append(e),e},this.updateOverlay=function(t,e){var n=$(t),r=n.outerHeight(!0)/this.factor,o=(n.offset().top-this.surfaceTop)/this.factor;r<i.OverlayMinHeight&&(r=i.OverlayMinHeight,o-=.5*i.OverlayMinHeight),e.css({height:r,top:o})},this.addHighlight=function(t,e){var n=this.surface.findNodeView(t);if(n){var r=this.addOverlay(n);return this.updateOverlay(n,r),r.addClass(e),r[0]}},this.addHighlights=function(t,e){for(var n=[],r=0;r<t.length;r++){var o=this.addHighlight(t[r],e);n.push(o)}return this.update(),n},this.removeHighlights=function(){for(var t=0;t<this.overlays.length;t++){var e=this.overlays[t];e.$overlay.remove()}},this.update=function(){var t=this.$nodes.height(),e=this.surface.$el.height();t>e?$(this.el).removeClass("hidden"):$(this.el).addClass("hidden"),this.factor=t/e,this.surfaceTop=this.$nodes.offset().top,this.scrollTop=this.surface.$el.scrollTop(),this.updateVisibleArea();for(var n=0;n<this.overlays.length;n++){var r=this.overlays[n];this.updateOverlay(r.el,r.$overlay)}},this.mouseDown=function(t){this._mouseDown=!0;var e=t.pageY;return t.target!==this.visibleArea?(this.offset=$(this.visibleArea).height()/2,this.mouseMove(t)):this.offset=e-$(this.visibleArea).position().top,!1
},this.mouseUp=function(){this._mouseDown=!1},this.mouseMove=function(t){if(this._mouseDown){var e=t.pageY,n=(e-this.offset)*this.factor;this.scrollTop=this.surface.$el.scrollTop(n),this.updateVisibleArea()}},this.onScroll=function(){this.surface&&(this.scrollTop=this.surface.$el.scrollTop(),this.updateVisibleArea())}},i.Prototype.prototype=n.prototype,i.prototype=new i.Prototype,i.OverlayMinHeight=5,e.exports=i},{"substance-application":149,underscore:175}],143:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").Controller,o=t("./reader_view"),i=t("./panels/content"),s=function(t,e,r){this.__document=t,this.options=r||{},this.panels=r.panels,this.contentPanel=new i(t),this.panelCtrls={},this.panelCtrls.content=this.contentPanel.createController(t),n.each(this.panels,function(e){this.panelCtrls[e.getName()]=e.createController(t)},this),this.workflows=r.workflows||[],this.state=e,this.currentPanel="toc"};s.Prototype=function(){this.createView=function(){return this.view||(this.view=new o(this)),this.view},this.switchPanel=function(t){this.currentPanel=t,this.modifyState({panel:t,focussedNode:null,fullscreen:!1})},this.getDocument=function(){return this.__document}},s.Prototype.prototype=r.prototype,s.prototype=new s.Prototype,e.exports=s},{"./panels/content":135,"./reader_view":144,"substance-application":149,underscore:175}],144:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-application").View,o=t("substance-data"),i=o.Graph.Index,s=t("substance-application").$$,a=function(t){r.call(this),this.readerCtrl=t,this.doc=this.readerCtrl.getDocument(),this.$el.addClass("article"),this.$el.addClass(this.doc.schema.id),this.bodyScroll={},this.contentView=t.panelCtrls.content.createView(),this.tocView=this.contentView.getTocView(),this.panelViews={},this.panelForRef={},n.each(t.panels,function(e){var r=e.getName(),o=t.panelCtrls[r];this.panelViews[r]=o.createView(),n.each(e.config.references,function(t){this.panelForRef[t]=r},this)},this),this.panelViews.toc=this.tocView,this.resources=new i(this.readerCtrl.getDocument(),{types:["resource_reference"],property:"target"}),this.lastWorkflow=null,this.lastPanel="toc",this._onTogglePanel=n.bind(this.switchPanel,this),this.listenTo(this.readerCtrl,"state-changed",this.updateState),this.listenTo(this.tocView,"toggle",this._onTogglePanel),n.each(this.panelViews,function(t){this.listenTo(t,"toggle",this._onTogglePanel),this.listenTo(t,"toggle-resource",this.onToggleResource),this.listenTo(t,"toggle-resource-reference",this.onToggleResourceReference),this.listenTo(t,"toggle-fullscreen",this.onToggleFullscreen)},this),this.listenTo(this.contentView,"toggle",this._onTogglePanel),this.listenTo(this.contentView,"toggle-resource",this.onToggleResource),this.listenTo(this.contentView,"toggle-resource-reference",this.onToggleResourceReference),this.listenTo(this.contentView,"toggle-fullscreen",this.onToggleFullscreen),n.each(this.readerCtrl.workflows,function(t){t.attach(this.readerCtrl,this)},this),$(window).resize(n.debounce(n.bind(function(){this.contentView.scrollbar.update();var t=this.panelViews[this.readerCtrl.state.panel];t&&t.hasScrollbar()&&t.scrollbar.update()},this),1))};a.Prototype=function(){this.render=function(){var t=document.createDocumentFragment();t.appendChild(this.contentView.render().el);var e=s(".context-toggles");e.appendChild(this.tocView.getToggleControl()),this.tocView.on("toggle",this._onClickPanel),n.each(this.readerCtrl.panels,function(t){var n=this.panelViews[t.getName()],r=n.getToggleControl();e.appendChild(r),n.on("toggle",this._onClickPanel)},this);var r=s(".medial-strip");r.appendChild(s(".separator-line")),r.appendChild(e),t.appendChild(r);var o=s(".resources");return o.appendChild(this.tocView.render().el),n.each(this.readerCtrl.panels,function(t){var e=this.panelViews[t.getName()];o.appendChild(e.render().el)},this),t.appendChild(o),this.el.appendChild(t),n.delay(n.bind(function(){this.updateState();var t=this;window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub]),window.MathJax.Hub.Queue(function(){console.log("Updating after MathJax has finished."),t.updateState()})},this),1),this},this.dispose=function(){n.each(this.workflows,function(t){t.detach()}),this.contentView.dispose(),n.each(this.panelViews,function(t){t.off("toggle",this._onClickPanel),t.dispose()},this),this.resources.dispose(),this.stopListening()},this.getState=function(){return this.readerCtrl.state},this.switchPanel=function(t){this.readerCtrl.switchPanel(t),this.lastPanel=t},this.updateState=function(){var t,e=this,r=this.readerCtrl.state,o={focussedNode:r.focussedNode?this.doc.get(r.focussedNode):null},i="content"===r.panel?this.contentView:this.panelViews[r.panel];if(n.each(this.panelViews,function(t){t.isHidden()||t.hide()}),this.contentView.removeHighlights(),n.each(this.panelViews,function(t){t.removeHighlights()}),r.focussedNode){var s=["focussed","highlighted"];r.fullscreen&&s.push("fullscreen"),i.addHighlight(r.focussedNode,s.join(" ")),i.scrollTo(r.focussedNode)}if(this.lastWorkflow&&(t=this.lastWorkflow.handleStateUpdate(r,o)),!t)for(var a=0;a<this.readerCtrl.workflows.length;a++){var c=this.readerCtrl.workflows[a];if(c!==this.lastWorkflow&&c.handlesStateUpdate&&(t=c.handleStateUpdate(r,o))){this.lastWorkflow=c;break}}if(!t)if("content"!==r.panel){var u=this.panelViews[r.panel];if(this.showPanel(r.panel),r.focussedNode){var l=this.resources.get(r.focussedNode);n.each(l,function(t){this.contentView.addHighlight(t.id,"highlighted ")},this),u.hasScrollbar()&&u.scrollTo(r.focussedNode)}}else this.showPanel("toc");e.updateScrollbars(),n.delay(function(){e.updateScrollbars()},2e3)},this.updateScrollbars=function(){this.readerCtrl.state;this.contentView.scrollbar.update(),n.each(this.panelViews,function(t){t.hasScrollbar()&&t.scrollbar.update()})},this.showPanel=function(t){this.panelViews[t]?(this.panelViews[t].activate(),this.el.dataset.context=t):"content"===t&&(this.panelViews.toc.activate(),this.el.dataset.context=t)},this.getPanelView=function(t){return this.panelViews[t]},this.onToggleResource=function(t,e,n){this.readerCtrl.modifyState(n.classList.contains("highlighted")?{panel:this.lastPanel,focussedNode:null,fullscreen:!1}:{panel:t,focussedNode:e})},this.onToggleResourceReference=function(t,e,n){this.readerCtrl.modifyState(n.classList.contains("highlighted")?{panel:this.lastPanel,focussedNode:null,fullscreen:!1}:{panel:"content",focussedNode:e,fullscreen:!1})},this.onToggleFullscreen=function(t,e){var n=!this.readerCtrl.state.fullscreen;this.readerCtrl.modifyState({panel:t,focussedNode:e,fullscreen:n})}},a.Prototype.prototype=r.prototype,a.prototype=new a.Prototype,a.prototype.constructor=a,e.exports=a},{"substance-application":149,"substance-data":155,underscore:175}],145:[function(t,e){"use strict";var n=t("underscore"),r=t("./workflow"),o=function(){r.apply(this,arguments),this._followCrossReference=n.bind(this.followCrossReference,this)};o.Prototype=function(){this.registerHandlers=function(){this.readerView.$el.on("click",".annotation.cross_reference",this._followCrossReference)},this.unRegisterHandlers=function(){this.readerView.$el.off("click",".annotation.cross_reference",this._followCrossReference)},this.followCrossReference=function(t){t.preventDefault(),t.stopPropagation();var e=t.currentTarget.dataset.id,n=this.readerCtrl.getDocument().get(e);this.readerView.contentView.scrollTo(n.target)}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,e.exports=o},{"./workflow":148,underscore:175}],146:[function(t,n){"use strict";var r=t("underscore"),o=t("./workflow"),i=function(){o.apply(this,arguments),this._gotoTop=r.bind(this.gotoTop,this)};i.Prototype=function(){this.registerHandlers=function(){this.readerView.$el.on("click",".document .content-node.heading .top",this._gotoTop)},this.unRegisterHandlers=function(){this.readerView.$el.off("click",".document .content-node.heading .top",this._gotoTop)},this.gotoTop=function(){e.preventDefault(),e.stopPropagation(),this.readerCtrl.contentView.jumpToNode("cover")}},i.Prototype.prototype=o.prototype,i.prototype=new i.Prototype,n.exports=i},{"./workflow":148,underscore:175}],147:[function(t,e){"use strict";var n=t("underscore"),r=t("./workflow"),o=function(){r.apply(this,arguments)};o.Prototype=function(){this.registerHandlers=function(){},this.unRegisterHandlers=function(){},this.handlesStateUpdate=!0,this.handleStateUpdate=function(t,e){if(e.focussedNode&&this.readerView.panelForRef[e.focussedNode.type]){var r=e.focussedNode,o=this.readerView.panelForRef[r.type],i=this.readerView.panelViews[o],s=this.readerView.contentView,a=r.target;i.activate();var c=["highlighted"];i.addHighlight(a,c.join(" ")),i.scrollTo(a);var u=this.readerView.resources.get(a);return delete u[r.id],n.each(u,function(t){s.addHighlight(t.id,"highlighted")},this),!0}return!1}},o.Prototype.prototype=r.prototype,o.prototype=new o.Prototype,e.exports=o},{"./workflow":148,underscore:175}],148:[function(t,e){"use strict";var n=function(){this.readerController=null,this.readerView=null};n.Prototype=function(){this.attach=function(t,e){this.readerCtrl=t,this.readerView=e,this.registerHandlers()},this.detach=function(){this.unRegisterHandlers(),this.readerView=null,this.readerController=null},this.registerHandlers=function(){throw new Error("This method is abstract")},this.unRegisterHandlers=function(){throw new Error("This method is abstract")},this.handlesStateUpdate=!1,this.handleStateUpdate=function(){throw new Error("This method is abstract")}},n.prototype=new n.Prototype,e.exports=n},{}],149:[function(t,e){"use strict";var n=t("./src/application");n.View=t("./src/view"),n.Router=t("./src/router"),n.Controller=t("./src/controller"),n.ElementRenderer=t("./src/renderers/element_renderer"),n.$$=n.ElementRenderer.$$,e.exports=n},{"./src/application":150,"./src/controller":151,"./src/renderers/element_renderer":152,"./src/router":153,"./src/view":154}],150:[function(t,e){"use strict";var n=t("./view"),r=t("./router"),o=(t("substance-util"),t("underscore")),i=function(t){n.call(this),this.config=t};i.Prototype=function(){this.initRouter=function(){this.router=new r,o.each(this.config.routes,function(t){this.router.route(t.route,t.name,o.bind(this.controller[t.command],this.controller))},this),r.history.start()},this.start=function(){this.$el=$("body"),this.el=this.$el[0],this.render(),this.initRouter()}},i.Prototype.prototype=n.prototype,i.prototype=new i.Prototype,e.exports=i},{"./router":153,"./view":154,"substance-util":167,underscore:175}],151:[function(t,e){"use strict";var n=t("substance-util"),r=t("underscore"),o=function(){this.state={},this.context=null};o.Prototype=function(){this.updateState=function(t,e){console.error("updateState is deprecated, use modifyState. State is now a rich object where context replaces the old state variable");var n=this.context;this.context=t,this.state=e,this.trigger("state-changed",this.context,n,e)},this.modifyState=function(t){var e=this.state.context;r.extend(this.state,t),t.context&&t.context!==e&&this.trigger("context-changed",t.context),this.trigger("state-changed",this.state.context)}},o.Prototype.prototype=n.Events,o.prototype=new o.Prototype,e.exports=o},{"substance-util":167,underscore:175}],152:[function(t,e){"use strict";var n=t("substance-util"),r=n.RegExp,o=function(t){return this.attributes=t,this.tagName=t.tag,this.children=t.children||[],this.text=t.text||"",this.html=t.html,delete t.children,delete t.text,delete t.html,delete t.tag,this.render()};o.Prototype=function(){this.render=function(){var t=document.createElement(this.tagName);this.html?t.innerHTML=this.html:t.textContent=this.text;for(var e in this.attributes){var n=this.attributes[e];t.setAttribute(e,n)}for(var r=0;r<this.children.length;r++){var o=this.children[r];t.appendChild(o)}return this.el=t,t}};var i=function(t,e){var e=e||{},n=/^([a-zA-Z0-9]*)/.exec(t);e.tag=n&&n[1]?n[1]:"div";var i=/#([a-zA-Z0-9_]*)/.exec(t);i&&i[1]&&(e.id=i[1]);var s=new r(/\.([a-zA-Z0-9_-]*)/g);return e.class||(e.class=s.match(t).map(function(t){return t.match[1]}).join(" ")),new o(e)};o.$$=i,o.Prototype.prototype=n.Events,o.prototype=new o.Prototype,e.exports=o},{"substance-util":167}],153:[function(t,e){"use strict";var n=t("substance-util"),r=t("underscore"),o=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},i=/\((.*?)\)/g,s=/(\(\?)?:\w+/g,a=/\*\w+/g,c=/[\-{}\[\]+?.,\\\^$|#\s]/g;r.extend(o.prototype,n.Events,{initialize:function(){},route:function(t,e,n){r.isRegExp(t)||(t=this._routeToRegExp(t)),r.isFunction(e)&&(n=e,e=""),n||(n=this[e]);var i=this;return o.history.route(t,function(r){var s=i._extractParameters(t,r);n&&n.apply(i,s),i.trigger.apply(i,["route:"+e].concat(s)),i.trigger("route",e,s),o.history.trigger("route",i,e,s)}),this},navigate:function(t,e){return o.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=r.result(this,"routes");for(var t,e=r.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(c,"\\$&").replace(i,"(?:$1)?").replace(s,function(t,e){return e?t:"([^/]+)"}).replace(a,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return r.map(n,function(t){return t?decodeURIComponent(t):null})}});var u=o.History=function(){this.handlers=[],r.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},l=/^[#\/]|\s+$/g,p=/^\/+|\/+$/g,h=/msie [\w.]+/,d=/\/$/;u.started=!1,r.extend(u.prototype,n.Events,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(d,"");t.indexOf(n)||(t=t.substr(n.length))}else t=this.getHash();return t.replace(l,"")},start:function(t){if(u.started)throw new Error("Router.history has already been started");u.started=!0,this.options=r.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment(),n=document.documentMode,o=h.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(p,"/"),o&&this._wantsHashChange&&(this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(l,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),u.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=r.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!u.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,n){if(n){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),o.history=new u,e.exports=o},{"substance-util":167,underscore:175}],154:[function(t,e){"use strict";var n=t("substance-util"),r=function(t){t=t||{};this.el=t.el||window.document.createElement(t.elementType||"div"),this.$el=$(this.el),this.dispatchDOMEvents()};r.Prototype=function(){this.$=function(t){return this.$el.find(t)},this.render=function(){return this},this.dispatchDOMEvents=function(){function t(t){var e=/(\w+)\((.*)\)/.exec(t);if(!e)throw new Error("Invalid click handler '"+t+"'");return{method:e[1],args:e[2].split(",")}}var e=this;this.$el.delegate("[sbs-click]","click",function(n){console.error("FIXME: sbs-click is deprecated. Use jquery handlers with selectors instead.");var r=t($(n.currentTarget).attr("sbs-click")),o=e[r.method];return o?(n.stopPropagation(),n.preventDefault(),o.apply(e,r.args),!1):void 0})}},r.Prototype.prototype=n.Events,r.prototype=new r.Prototype,e.exports=r},{"substance-util":167}],155:[function(t,e){"use strict";var n={};n.VERSION="0.8.0",n.Graph=t("./src/graph"),e.exports=n},{"./src/graph":156}],156:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=r.errors,i=t("./schema"),s=t("./property"),a=t("./graph_index"),c=o.define("GraphError"),u=["object","array","string","number","boolean","date"],l=function(t){return n.isArray(t)&&(t=t[0]),u.indexOf(t)>=0},p=function(t,e){if(e=e||{},this.schema=new i(t),this.schema.id&&e.seed&&e.seed.schema&&!n.isEqual(e.seed.schema,[this.schema.id,this.schema.version]))throw new c(["Graph does not conform to schema. Expected: ",this.schema.id+"@"+this.schema.version," Actual: ",e.seed.schema[0]+"@"+e.seed.schema[1]].join(""));this.nodes={},this.indexes={},this.__seed__=e.seed,this.init()};p.Prototype=function(){n.extend(this,r.Events),this.create=function(t){this.nodes[t.id]=t,this._updateIndexes({type:"create",path:[t.id],val:t})},this.delete=function(t){var e=this.nodes[t];delete this.nodes[t],this._updateIndexes({type:"delete",path:[t],val:e})},this.set=function(t,e){var n=this.resolve(t);if(!n)throw new c("Could not resolve property with path "+JSON.stringify(t));var r=n.get();n.set(e),this._updateIndexes({type:"set",path:t,val:e,original:r})},this.get=function(t){if(!n.isArray(t)&&!n.isString(t))throw new c("Invalid argument path. Must be String or Array");if(arguments.length>1&&(t=n.toArray(arguments)),n.isString(t))return this.nodes[t];var e=this.resolve(t);return e.get()},this.query=function(t){var e=this.resolve(t),n=e.type,r=e.baseType,o=e.get();return"array"===r?this._queryArray.call(this,o,n):l(r)?o:this.get(o)},this.toJSON=function(){return{id:this.id,schema:[this.schema.id,this.schema.version],nodes:r.deepclone(this.nodes)}},this.contains=function(t){return!!this.nodes[t]},this.resolve=function(t){return new s(this,t)},this.reset=function(){this.init(),this.trigger("graph:reset")},this.init=function(){this.__is_initializing__=!0,this.nodes=this.__seed__?r.clone(this.__seed__.nodes):{},n.each(this.indexes,function(t){t.reset()}),delete this.__is_initializing__},this.addIndex=function(t,e){if(this.indexes[t])throw new c("Index with name "+t+"already exists.");var n=new a(this,e);return this.indexes[t]=n,n},this.removeIndex=function(t){delete this.indexes[t]},this._updateIndexes=function(t){n.each(this.indexes,function(e){t?e.onGraphChange(t):e.rebuild()},this)},this._queryArray=function(t,e){if(!n.isArray(e))throw new c("Illegal argument: array types must be specified as ['array'(, 'array')*, <type>]");var r,o;if("array"===e[1])for(r=[],o=0;o<t.length;o++)r.push(this._queryArray(t[o],e.slice(1)));else if(l(e[1]))r=t;else for(r=[],o=0;o<t.length;o++)r.push(this.get(t[o]));return r}},p.STRICT_INDEXING=2,p.DEFAULT_MODE=p.STRICT_INDEXING,p.prototype=new p.Prototype,p.Schema=i,p.Property=s,p.Index=a,e.exports=p},{"./graph_index":157,"./property":158,"./schema":159,"substance-util":167,underscore:175}],157:[function(t,e){var n=t("underscore"),r=t("substance-util"),o=function(t,e){e=e||{},this.graph=t,this.nodes={},this.scopes={},e.filter?this.filter=e.filter:e.types&&(this.filter=o.typeFilter(t.schema,e.types)),e.property&&(this.property=e.property),this.createIndex()};o.Prototype=function(){var t=function(t){var e=this;if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];e.scopes[r]=e.scopes[r]||{nodes:{},scopes:{}},e=e.scopes[r]}return e},e=function(t){if(!this.property)return null;var e=t[this.property]?t[this.property]:null;return n.isString(e)&&(e=[e]),e},r=function(t){var e=n.extend({},t.nodes);return n.each(t.scopes,function(t,o){"nodes"!==o&&n.extend(e,r(t))}),e};this.onGraphChange=function(t){this.applyOp(t)},this._add=function(n){if(!this.filter||this.filter(n)){var r=e.call(this,n),o=t.call(this,r);o.nodes[n.id]=n.id}},this._remove=function(n){if(!this.filter||this.filter(n)){var r=e.call(this,n),o=t.call(this,r);delete o.nodes[n.id]}},this._update=function(e,r,o,i){if(this.property===r&&(!this.filter||this.filter(e))){var s=i;n.isString(s)&&(s=[s]);var a=t.call(this,s);delete a.nodes[e.id],s=o,a.nodes[e.id]=e.id}},this.applyOp=function(t){if("create"===t.type)this._add(t.val);else if("delete"===t.type)this._remove(t.val);else{var e,n=this.graph.resolve(this,t.path),r=n.get();if(void 0===r)return;"set"===t.type?e=t.original:console.error("Operational updates are not supported in this implementation"),this._update(n.node,n.key,r,e)}},this.createIndex=function(){this.reset();var r=this.graph.nodes;n.each(r,function(n){if(!this.filter||this.filter(n)){var r=e.call(this,n),o=t.call(this,r);o.nodes[n.id]=n.id}},this)},this.get=function(e){0===arguments.length?e=null:n.isString(e)&&(e=[e]);var i=t.call(this,e),s=r(i),a=new o.Result;return n.each(s,function(t){a[t]=this.graph.get(t)},this),a},this.reset=function(){this.nodes={},this.scopes={}},this.dispose=function(){this.stopListening()},this.rebuild=function(){this.reset(),this.createIndex()}},o.prototype=n.extend(new o.Prototype,r.Events.Listener),o.typeFilter=function(t,e){return function(n){for(var r=t.typeChain(n.type),o=0;o<e.length;o++)if(r.indexOf(e[o])>=0)return!0;return!1}},o.Result=function(){},o.Result.prototype.asList=function(){var t=[];for(var e in this)t.push(this[e])},o.Result.prototype.getLength=function(){return Object.keys(this).length},e.exports=o},{"substance-util":167,underscore:175}],158:[function(t,e){"use strict";var n=t("underscore"),r=function(t,e){if(!e)throw new Error("Illegal argument: path is null/undefined.");this.graph=t,this.schema=t.schema,n.extend(this,this.resolve(e))};r.Prototype=function(){this.resolve=function(t){for(var e,n,r=this.graph,o=r,i="graph",s=0;s<t.length;s++)if("graph"===i||void 0!==this.schema.types[i]){if(o=this.graph.get(t[s]),void 0===o)return void 0;r=o,i=this.schema.properties(o.type),n=r,e=void 0}else{if(void 0===o)return void 0;e=t[s];var a=t[s];i=i[a],n=o[e],s<t.length-1&&(o=o[a])}return{node:r,parent:o,type:i,key:e,value:n}},this.get=function(){return void 0!==this.key?this.parent[this.key]:this.node},this.set=function(t){if(void 0===this.key)throw new Error("'set' is only supported for node properties.");this.parent[this.key]=this.schema.parseValue(this.baseType,t)}},r.prototype=new r.Prototype,Object.defineProperties(r.prototype,{baseType:{get:function(){return n.isArray(this.type)?this.type[0]:this.type}},path:{get:function(){return[this.node.id,this.key]}}}),e.exports=r},{underscore:175}],159:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=function(t){n.extend(this,t)};o.Prototype=function(){this.defaultValue=function(t){return"object"===t?{}:"array"===t?[]:"string"===t?"":"number"===t?0:"boolean"===t?!1:"date"===t?new Date:null},this.parseValue=function(t,e){if(null===e)return e;if(n.isString(e)){if("object"===t)return JSON.parse(e);if("array"===t)return JSON.parse(e);if("string"===t)return e;if("number"===t)return parseInt(e,10);if("boolean"===t){if("true"===e)return!0;if("false"===e)return!1;throw new Error("Can not parse boolean value from: "+e)}return"date"===t?new Date(e):e}if("array"===t){if(!n.isArray(e))throw new Error("Illegal value type: expected array.");e=r.deepclone(e)}else if("string"===t){if(!n.isString(e))throw new Error("Illegal value type: expected string.")}else if("object"===t){if(!n.isObject(e))throw new Error("Illegal value type: expected object.");e=r.deepclone(e)}else if("number"===t){if(!n.isNumber(e))throw new Error("Illegal value type: expected number.")}else if("boolean"===t){if(!n.isBoolean(e))throw new Error("Illegal value type: expected boolean.")}else{if("date"!==t)throw new Error("Unsupported value type: "+t);e=new Date(e)}return e},this.type=function(t){return this.types[t]},this.typeChain=function(t){var e=this.types[t];if(!e)throw new Error("Type "+t+" not found in schema");var n=e.parent?this.typeChain(e.parent):[];return n.push(t),n},this.isInstanceOf=function(t,e){var n=this.typeChain(t);return n&&n.indexOf(e)>=0?!0:!1},this.baseType=function(t){return this.typeChain(t)[0]},this.properties=function(t){t=n.isObject(t)?t:this.type(t);var e=t.parent?this.properties(t.parent):{};return n.extend(e,t.properties),e},this.propertyType=function(t,e){var r=this.properties(t),o=r[e];if(!o)throw new Error("Property not found for"+t+"."+e);return n.isArray(o)?o:[o]},this.propertyBaseType=function(t,e){return this.propertyType(t,e)[0]}},o.prototype=new o.Prototype,e.exports=o},{"substance-util":167,underscore:175}],160:[function(t,e){"use strict";var n=(t("underscore"),t("./src/document"));n.Container=t("./src/container"),n.Controller=t("./src/controller"),n.Node=t("./src/node"),n.Composite=t("./src/composite"),n.TextNode=t("./src/text_node"),e.exports=n},{"./src/composite":161,"./src/container":162,"./src/controller":163,"./src/document":164,"./src/node":165,"./src/text_node":166,underscore:175}],161:[function(t,e){var n=t("./node"),r=function(t,e){n.call(this,t,e)};r.type={id:"composite",parent:"content",properties:{}},r.description={name:"Composite",remarks:["A file reference to an external resource."],properties:{}},r.example={no_example:"yet"},r.Prototype=function(){this.getLength=function(){throw new Error("Composite.getLength() is abstract.")},this.getNodes=function(){return this.getChildrenIds()},this.getChildrenIds=function(){throw new Error("Composite.getChildrenIds() is abstract.")},this.isMutable=function(){return!1},this.insertOperation=function(){return null},this.deleteOperation=function(){return null},this.insertChild=function(){throw new Error("This composite is immutable.")},this.deleteChild=function(){throw new Error("This composite is immutable.")},this.getChangePosition=function(){return 0}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,e.exports=r},{"./node":165}],162:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=t("./composite"),i=function(t,e){this.document=t,this.view=e,this.treeView=[],this.listView=[],this.__parents={},this.__composites={},this.rebuild()};i.Prototype=function(){var t=function(t,e){var n,r=[];for(n=this.treeView.length-1;n>=0;n--)r.unshift({id:this.treeView[n],parent:null});for(var i,s;r.length>0;){if(i=r.shift(),s=this.document.get(i.id),s instanceof o){var a=s.getNodes();for(n=a.length-1;n>=0;n--)r.unshift({id:a[n],parent:s.id})}t.call(e,s,i.parent)}};this.rebuild=function(){this.treeView.splice(0,this.treeView.length),this.listView.splice(0,this.listView.length),this.treeView=n.clone(this.view.nodes);for(var e=0;e<this.view.length;e++)this.treeView.push(this.view[e]);this.__parents={},this.__composites={},t.call(this,function(t,e){if(t instanceof o)this.__parents[t.id]=e,this.__composites[e]=e;else{if(this.listView.push(t.id),this.__parents[t.id])throw new Error("Nodes must be unique in one view.");this.__parents[t.id]=e,this.__composites[e]=e}},this)},this.getTopLevelNodes=function(){return n.map(this.treeView,function(t){return this.document.get(t)},this)},this.getNodes=function(t){var e=this.listView;if(t)return n.clone(e);for(var r=[],o=0;o<e.length;o++)r.push(this.document.get(e[o]));return r},this.getPosition=function(t){var e=this.listView;return e.indexOf(t)},this.getNodeFromPosition=function(t){var e=this.listView,n=e[t];return void 0!==n?this.document.get(n):null},this.getParent=function(t){return this.__parents[t]},this.getRoot=function(t){for(var e=t;e;)t=e,e=this.getParent(t);return t},this.update=function(t){var e=t.path,n=e[0]===this.view.id||void 0!==this.__composites[e[0]];n&&this.rebuild()},this.getLength=function(){return this.listView.length},this.hasSuccessor=function(t){var e=this.getLength();return e-1>t},this.hasPredecessor=function(t){return t>0},this.getPredecessor=function(t){var e=this.getPosition(t);return 0>=e?null:this.getNodeFromPosition(e-1)},this.getSuccessor=function(t){var e=this.getPosition(t);return e>=this.getLength()-1?null:this.getNodeFromPosition(e+1)},this.firstChild=function(t){if(t instanceof o){var e=this.document.get(t.getNodes()[0]);return this.firstChild(e)}return t},this.lastChild=function(t){if(t instanceof o){var e=this.document.get(n.last(t.getNodes()));return this.lastChild(e)}return t},this.before=function(t){var e=this.firstChild(t),n=this.getPosition(e.id);return[n,0]},this.after=function(t){var e=this.lastChild(t),n=this.getPosition(e.id),r=e.getLength();return[n,r]}},i.prototype=n.extend(new i.Prototype,r.Events.Listener),Object.defineProperties(i.prototype,{id:{get:function(){return this.view.id}},type:{get:function(){return this.view.type}},nodes:{get:function(){return this.view.nodes},set:function(t){this.view.nodes=t}}}),e.exports=i},{"./composite":161,"substance-util":167,underscore:175}],163:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=function(t,e){e=e||{},this.view=e.view||"content",this.__document=t,this.container=t.get(this.view)};o.Prototype=function(){this.getNodes=function(t){return this.container.getNodes(t)},this.getContainer=function(){return this.container},this.getPosition=function(t,e){return this.container.getPosition(t,e)},this.getNodeFromPosition=function(t){return this.container.getNodeFromPosition(t)},this.getAnnotations=function(t){return t=t||{},t.view=this.view,this.annotator.getAnnotations(t)},this.get=function(){return this.__document.get.apply(this.__document,arguments)},this.on=function(){return this.__document.on.apply(this.__document,arguments)},this.off=function(){return this.__document.off.apply(this.__document,arguments)},this.getDocument=function(){return this.__document}},o.prototype=n.extend(new o.Prototype,r.Events.Listener),Object.defineProperties(o.prototype,{id:{get:function(){return this.__document.id},set:function(){throw"immutable property"}},nodeTypes:{get:function(){return this.__document.nodeTypes},set:function(){throw"immutable property"}},title:{get:function(){return this.__document.get("document").title},set:function(){throw"immutable property"}},updated_at:{get:function(){return this.__document.get("document").updated_at},set:function(){throw"immutable property"}},creator:{get:function(){return this.__document.get("document").creator},set:function(){throw"immutable property"}}}),e.exports=o},{"substance-util":167,underscore:175}],164:[function(t,e){"use strict";var n=t("underscore"),r=t("substance-util"),o=r.errors,i=t("substance-data"),s=t("./container"),a=o.define("DocumentError"),c=function(t){i.Graph.call(this,t.schema,t),this.containers={},this.addIndex("annotations",{types:["annotation"],property:"path"})
};c.schema={indexes:{},types:{content:{properties:{}},view:{properties:{nodes:["array","content"]}}}},c.Prototype=function(){var t=r.prototype(this);this.getIndex=function(t){return this.indexes[t]},this.getSchema=function(){return this.schema},this.create=function(e){return t.create.call(this,e),this.get(e.id)},this.get=function(e){var n=t.get.call(this,e);if(!n)return n;if("view"===n.type)return this.containers[n.id]||(this.containers[n.id]=new s(this,n)),this.containers[n.id];var r=this.nodeTypes[n.type],o=void 0!==r?r.Model:null;return!o||n instanceof o||(n=new o(n,this),this.nodes[n.id]=n),n},this.toJSON=function(){var e=t.toJSON.call(this);return e.id=this.id,e},this.hide=function(t,e){var r=this.get(t);if(!r)throw new a("Invalid view id: "+t);n.isString(e)&&(e=[e]);var o=[];if(n.each(e,function(t){var e=r.nodes.indexOf(t);e>=0&&o.push(e)},this),0!==o.length){o=o.sort().reverse(),o=n.uniq(o);for(var i=this.nodes[t],s=0;s<o.length;s++)i.nodes.splice(o[s],1)}},this.show=function(t,e,n){void 0===n&&(n=-1);var r=this.get(t);if(!r)throw new a("Invalid view id: "+t);var o=r.nodes.length;n=Math.min(n,o),0>n&&(n=Math.max(0,o+n+1)),r.nodes.splice(n,0,e)},this.fromSnapshot=function(t,e){return c.fromSnapshot(t,e)},this.uuid=function(t){return t+"_"+r.uuid()}},c.Prototype.prototype=i.Graph.prototype,c.prototype=new c.Prototype,c.fromSnapshot=function(t,e){return e=e||{},e.seed=t,new c(e)},c.DocumentError=a,e.exports=c},{"./container":162,"substance-data":155,"substance-util":167,underscore:175}],165:[function(t,e){"use strict";var n=t("underscore"),r=function(t,e){this.document=e,this.properties=t};r.type={parent:"content",properties:{}},r.properties={"abstract":!0,immutable:!0,mergeableWith:[],preventEmpty:!0,allowedAnnotations:[]},r.Prototype=function(){this.toJSON=function(){return n.clone(this.properties)},this.getLength=function(){throw new Error("Node.getLength() is abstract.")},this.getChangePosition=function(){throw new Error("Node.getCharPosition() is abstract.")},this.insertOperation=function(){throw new Error("Node.insertOperation() is abstract.")},this.deleteOperation=function(){throw new Error("Node.deleteOperation() is abstract.")},this.canJoin=function(){return!1},this.join=function(){throw new Error("Node.join() is abstract.")},this.isBreakable=function(){return!1},this.break=function(){throw new Error("Node.split() is abstract.")},this.getAnnotations=function(){return this.document.getIndex("annotations").get(this.properties.id)},this.includeInToc=function(){return!1}},r.prototype=new r.Prototype,r.prototype.constructor=r,r.defineProperties=function(t,e,r){var o=t;if(1===arguments.length){var i=t;if(o=i.prototype,!o||!i.type)throw new Error("Illegal argument: expected NodeClass");e=Object.keys(i.type.properties)}n.each(e,function(t){var e={get:function(){return this.properties[t]}};r||(e.set=function(e){return this.properties[t]=e,this}),Object.defineProperty(o,t,e)})},r.defineProperties(r.prototype,["id","type"]),e.exports=r},{underscore:175}],166:[function(t,e){"use strict";var n=t("./node"),r=function(t,e){n.call(this,t,e)};r.type={id:"text",parent:"content",properties:{source_id:"Text element source id",content:"string"}},r.description={name:"Text",remarks:["A simple text fragement that can be annotated. Usually text nodes are combined in a paragraph."],properties:{content:"Content"}},r.example={type:"paragraph",id:"paragraph_1",content:"Lorem ipsum dolor sit amet, adipiscing elit."},r.Prototype=function(){this.getLength=function(){return this.properties.content.length}},r.Prototype.prototype=n.prototype,r.prototype=new r.Prototype,r.prototype.constructor=r,n.defineProperties(r.prototype,["content"]),e.exports=r},{"./node":165}],167:[function(t,e){"use strict";var n=t("./src/util");n.async=t("./src/async"),n.errors=t("./src/errors"),n.html=t("./src/html"),n.dom=t("./src/dom"),n.RegExp=t("./src/regexp"),n.Fragmenter=t("./src/fragmenter"),e.exports=n},{"./src/async":168,"./src/dom":169,"./src/errors":170,"./src/fragmenter":171,"./src/html":172,"./src/regexp":173,"./src/util":174}],168:[function(t,e){"use strict";function n(t,e){function n(t){var e=a[c];if(!e)return l.length>0?r(new Error("Multiple errors occurred.",t)):r(null,t);var s=o.once(function(t,e){if(t){if(u)return r(t,null);l.push(t)}c+=1,n(e)});try{0===e.length?(e(),s(null,t)):1===e.length?e(s):e(t,s)}catch(p){console.log("util.async caught error:",p),i.printStackTrace(p),r(p)}}var r=t["finally"]||function(t,n){e(t,n)};r=o.once(r);var s=t.data||{},a=t.functions;if(!o.isFunction(e))return e("Illegal arguments: a callback function must be provided");var c=0,u=void 0===t.stopOnError?!0:t.stopOnError,l=[];n(s)}function r(t){return function(e,r){function i(t,e){return function(n,r){2===p.length?p(t,r):3===p.length?p(t,e,r):p(t,e,n,r)}}function s(t,e){return function(n,r){2===p.length?p(t,r):3===p.length?p(t,e,r):p(t,e,n,r)}}var a=t.selector?t.selector(e):t.items,c=t["finally"]||function(t,e){r(t,e)};if(c=o.once(c),!a)return c(null,e);var u=o.isArray(a);t.before&&t.before(e);var l=[],p=t.iterator;if(u)for(var h=0;h<a.length;h++)l.push(i(a[h],h));else for(var d in a)l.push(s(a[d],d));var f={functions:l,data:e,"finally":c,stopOnError:t.stopOnError};n(f,r)}}var o=t("underscore"),i=t("./util.js"),s={};s.sequential=function(t,e){o.isArray(t)&&(t={functions:t}),n(t,e)},s.iterator=function(t,e){var n;return n=1==arguments.length?t:{items:t,iterator:e},r(n)},s.each=function(t,e){var n=r(t);n(null,e)},e.exports=s},{"./util.js":174,underscore:175}],169:[function(t,e){"use strict";var n=t("underscore"),r={};r.ChildNodeIterator=function(t){this.nodes=n.isArray(t)?t:t.childNodes,this.length=this.nodes.length,this.pos=-1},r.ChildNodeIterator.prototype={hasNext:function(){return this.pos<this.length-1},next:function(){return this.pos+=1,this.nodes[this.pos]},back:function(){return this.pos>=0&&(this.pos-=1),this}},r.getChildren=function(t){if(void 0!==t.children)return t.children;for(var e=[],n=t.firstElementChild;n;)e.push(n),n=n.nextElementSibling;return e},r.getNodeType=function(t){return t.nodeType===window.Node.TEXT_NODE?"text":t.nodeType===window.Node.COMMENT_NODE?"comment":t.tagName?t.tagName.toLowerCase():(console.error("Can't get node type for ",t),"unknown")},e.exports=r},{underscore:175}],170:[function(t,e){"use strict";var n=t("./util"),r={},o=function(t,e){e?(Error.call(this,t,e.fileName,e.lineNumber),this.__stack=e instanceof o?e.__stack:e.stack?n.parseStackTrace(e):n.callstack(1)):(Error.call(this,t),this.__stack=n.callstack(1)),this.message=t};o.Prototype=function(){this.name="SubstanceError",this.code=-1,this.toString=function(){return this.name+":"+this.message},this.toJSON=function(){return{name:this.name,message:this.message,code:this.code,stack:this.stack}},this.printStackTrace=function(){n.printStackTrace(this)}},o.Prototype.prototype=Error.prototype,o.prototype=new o.Prototype,Object.defineProperty(o.prototype,"stack",{get:function(){for(var t=[],e=0;e<this.__stack.length;e++){var n=this.__stack[e];t.push(n.file+":"+n.line+":"+n.col+" ("+n.func+")")}return t.join("\n")},set:function(){throw new Error("SubstanceError.stack is read-only.")}}),r.SubstanceError=o;var i=function(t,e,n){return function(r){t.call(this,r),this.name=e,this.code=n}};r.define=function(t,e,n){if(!t)throw new o("Name is required.");void 0===e&&(e=-1),n=n||o;var s=i(n,t,e),a=function(){};return a.prototype=n.prototype,s.prototype=new a,s.prototype.constructor=s,r[t]=s,s},e.exports=r},{"./util":174}],171:[function(t,e){"use strict";var n=t("underscore"),r=1,o=-1,i=function(t){this.levels=t||{}};i.Prototype=function(){var t=function(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===r){if(t.level<e.level)return-1;if(t.level>e.level)return 1}if(t.mode===o){if(t.level>e.level)return-1;if(t.level<e.level)return 1}return 0},e=function(t){var e=[];return n.each(t,function(t){var n=this.levels[t.type]||1e3;void 0!==n&&(e.push({pos:t.range[0],mode:r,level:n,id:t.id,type:t.type,node:t}),e.push({pos:t.range[1],mode:o,level:n,id:t.id,type:t.type,node:t}))},this),e};this.onText=function(){},this.onEnter=function(){return null},this.onExit=function(){},this.enter=function(t,e){return this.onEnter(t,e)},this.exit=function(t,e){this.onExit(t,e)},this.createText=function(t,e){this.onText(t,e)},this.start=function(n,i,s){var a=e.call(this,s);a.sort(t.bind(this));for(var c=[{context:n,entry:null}],u=0,l=0;l<a.length;l++){var p=a[l];this.createText(c[c.length-1].context,i.substring(u,p.pos)),u=p.pos;var h,d=1;if(p.mode===r){for(;d<c.length&&!(p.level<c[d].entry.level);d++);c.splice(d,0,{entry:p})}else if(p.mode===o){for(;d<c.length&&c[d].entry.id!==p.id;d++);for(h=d;h<c.length;h++)this.exit(c[h].entry,c[h-1].context);c.splice(d,1)}for(h=d;h<c.length;h++)c[h].context=this.enter(c[h].entry,c[h-1].context)}this.createText(n,i.substring(u))}},i.prototype=new i.Prototype,e.exports=i},{underscore:175}],172:[function(t,e){"use strict";var n={},r=t("underscore");n.templates={},n.renderTemplate=function(t,e){return n.templates[t](e)},"undefined"!=typeof window&&(window.console||(window.console={log:function(){}})),n.tpl=function(t,e){e=e||{};var n=window.$("script[name="+t+"]").html();return r.template(n,e)},e.exports=n},{underscore:175}],173:[function(t,e){"use strict";var n=function(t){this.index=t.index,this.match=[];for(var e=0;e<t.length;e++)this.match.push(t[e])};n.Prototype=function(){this.captures=function(){return this.match.slice(1)},this.toString=function(){return this.match[0]}},n.prototype=new n.Prototype;var r=function(t){this.exp=t};r.Prototype=function(){this.match=function(t){if(void 0===t)throw new Error("No string given");if(this.exp.global){var e,r=[];for(this.exp.compile(this.exp);null!==(e=this.exp.exec(t));)r.push(new n(e));return r}return this.exp.exec(t)}},r.prototype=new r.Prototype,r.Match=n,e.exports=r},{}],174:[function(t,e){"use strict";var n=t("underscore"),r={};r.uuid=function(t,e){var n,r="0123456789abcdefghijklmnopqrstuvwxyz".split(""),o=[],i=16;if(e=e||32)for(n=0;e>n;n++)o[n]=r[0|Math.random()*i];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;36>n;n++)o[n]||(s=0|16*Math.random(),o[n]=r[19==n?3&s|8:s])}return(t?t:"")+o.join("")},r.uuidGen=function(t){var e=1;return t=void 0!==t?t:"uuid_",function(n){return n=n||t,n+e++}};var o=function(t,e){var n,r=-1,o=t.length,i=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++r<o;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s);return;case 3:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,s,a);return;default:for(;++r<o;)(n=t[r]).callback.apply(n.ctx,e)}},i=/\s+/,s=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var o in n)t[e].apply(t,[o,n[o]].concat(r));return!1}if(i.test(n)){for(var s=n.split(i),a=0,c=s.length;c>a;a++)t[e].apply(t,[s[a]].concat(r));return!1}return!0};r.Events={on:function(t,e,n){if(!s(this,"on",t,[e,n])||!e)return this;this._events=this._events||{};var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,r){if(!s(this,"once",t,[e,r])||!e)return this;var o=this,i=n.once(function(){o.off(t,i),e.apply(this,arguments)});return i._callback=e,this.on(t,i,r)},off:function(t,e,r){var o,i,a,c,u,l,p,h;if(!this._events||!s(this,"off",t,[e,r]))return this;if(!t&&!e&&!r)return this._events={},this;for(c=t?[t]:n.keys(this._events),u=0,l=c.length;l>u;u++)if(t=c[u],a=this._events[t]){if(this._events[t]=o=[],e||r)for(p=0,h=a.length;h>p;p++)i=a[p],(e&&e!==i.callback&&e!==i.callback._callback||r&&r!==i.context)&&o.push(i);o.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=Array.prototype.slice.call(arguments,1);if(!s(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&o(n,e),r&&o(r,arguments),this},triggerLater:function(){var t=this,e=arguments;window.setTimeout(function(){t.trigger.apply(t,e)},0)},stopListening:function(t,e,n){var r=this._listeners;if(!r)return this;var o=!e&&!n;"object"==typeof e&&(n=this),t&&((r={})[t._listenerId]=t);for(var i in r)r[i].off(e,n,this),o&&delete this._listeners[i];return this}};var a={listenTo:"on",listenToOnce:"once"};n.each(a,function(t,e){r.Events[e]=function(e,r,o){var i=this._listeners||(this._listeners={}),s=e._listenerId||(e._listenerId=n.uniqueId("l"));return i[s]=e,"object"==typeof r&&(o=this),e[t](r,o,this),this}}),r.Events.bind=r.Events.on,r.Events.unbind=r.Events.off,r.Events.Listener={listenTo:function(t,e,r){if(!n.isFunction(r))throw new Error("Illegal argument: expecting function as callback, was: "+r);return this._handlers=this._handlers||[],t.on(e,r,this),this._handlers.push({unbind:function(){t.off(e,r)}}),this},stopListening:function(){if(this._handlers)for(var t=0;t<this._handlers.length;t++)this._handlers[t].unbind()}},r.propagate=function(t,e){if(!n.isFunction(e))throw"Illegal argument: provided callback is not a function";return function(n){return n?e(n):void e(null,t)}};var c=function(){};r.inherits=function(t,e,r){var o;return o=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},n.extend(o,t),c.prototype=t.prototype,o.prototype=new c,e&&n.extend(o.prototype,e),r&&n.extend(o,r),o.prototype.constructor=o,o.__super__=t.prototype,o},r.getJSON=function(e,n){if("undefined"==typeof window||"undefined"!=typeof nwglobal){var r=t("fs"),o=JSON.parse(r.readFileSync(e,"utf8"));n(null,o)}else{var i=window.$;i.getJSON(e).done(function(t){n(null,t)}).error(function(t){n(t,null)})}},r.prototype=function(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__},r.inherit=function(t,e){var r,o=n.isFunction(t)?new t:t;if(n.isFunction(e))e.prototype=o,r=new e;else{var i=function(){};i.prototype=o,r=n.extend(new i,e)}return r},r.pimpl=function(t){var e=function(t){this.self=t};return e.prototype=t,function(t){return t=t||this,new e(t)}},r.parseStackTrace=function(t){var e,n=/([^@]*)@(.*):(\d+)/,r=/\s*at ([^(]*)[(](.*):(\d+):(\d+)[)]/,o=t.stack.split("\n"),i=[];for(e=0;e<o.length;e++){var s=n.exec(o[e]);s||(s=r.exec(o[e]));var a;s?(a={func:s[1],file:s[2],line:s[3],col:s[4]||0},""===a.func&&(a.func="<anonymous>")):a={func:"",file:o[e],line:"",col:""},i.push(a)}return i},r.callstack=function(t){var e;try{throw new Error}catch(n){e=n}var o=r.parseStackTrace(e);return t=t||0,o.splice(t+1)},r.stacktrace=function(t){var e=0===arguments.length?r.callstack().splice(1):r.parseStackTrace(t),o=[];return n.each(e,function(t){o.push(t.file+":"+t.line+":"+t.col+" ("+t.func+")")}),o.join("\n")},r.printStackTrace=function(t,e){if(t.stack){var o;if(void 0!==t.__stack)o=t.__stack;else{if(!n.isString(t.stack))return;o=r.parseStackTrace(t)}e=e||o.length,e=Math.min(e,o.length);for(var i=0;e>i;i++){var s=o[i];console.log(s.file+":"+s.line+":"+s.col,"("+s.func+")")}}},r.diff=function(t,e){var o;return n.isArray(t)&&n.isArray(e)?(o=n.difference(e,t),0===o.length?null:o):n.isObject(t)&&n.isObject(e)?(o={},n.each(Object.keys(e),function(n){var i=r.diff(t[n],e[n]);i&&(o[n]=i)}),n.isEmpty(o)?null:o):t!==e?e:void 0},r.deepclone=function(t){return void 0===t?void 0:null===t?null:JSON.parse(JSON.stringify(t))},r.clone=function(t){return null===t||void 0===t?t:n.isFunction(t.clone)?t.clone():r.deepclone(t)},r.freeze=function(t){var e;if(n.isObject(t)){if(Object.isFrozen(t))return t;var o=Object.keys(t);for(e=0;e<o.length;e++){var i=o[e];t[i]=r.freeze(t[i])}return Object.freeze(t)}if(n.isArray(t)){var s=t;for(e=0;e<s.length;e++)s[e]=r.freeze(s[e]);return Object.freeze(s)}return t},r.later=function(t,e){return function(){var n=arguments;window.setTimeout(function(){t.apply(e,n)},0)}},r.isEmpty=function(t){return!t.match(/\w/)},r.slug=function(t){t=t.replace(/^\s+|\s+$/g,""),t=t.toLowerCase();for(var e="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",n="aaaaeeeeiiiioooouuuunc------",r=0,o=e.length;o>r;r++)t=t.replace(new RegExp(e.charAt(r),"g"),n.charAt(r));return t=t.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},r.getReadableFileSizeString=function(t){var e=-1,n=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do t/=1024,e++;while(t>1024);return Math.max(t,.1).toFixed(1)+n[e]},e.exports=r},{fs:177,underscore:175}],175:[function(t,e,n){(function(){var t=this,r=t._,o={},i=Array.prototype,s=Object.prototype,a=Function.prototype,c=i.push,u=i.slice,l=i.concat,p=s.toString,h=s.hasOwnProperty,d=i.forEach,f=i.map,g=i.reduce,y=i.reduceRight,m=i.filter,v=i.every,b=i.some,w=i.indexOf,_=i.lastIndexOf,x=Array.isArray,C=Object.keys,P=a.bind,T=function(t){return t instanceof T?t:this instanceof T?void(this._wrapped=t):new T(t)};"undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=T),n._=T):t._=T,T.VERSION="1.5.2";var N=T.each=T.forEach=function(t,e,n){if(null!=t)if(d&&t.forEach===d)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,i=t.length;i>r;r++)if(e.call(n,t[r],r,t)===o)return}else for(var s=T.keys(t),r=0,i=s.length;i>r;r++)if(e.call(n,t[s[r]],s[r],t)===o)return};T.map=T.collect=function(t,e,n){var r=[];return null==t?r:f&&t.map===f?t.map(e,n):(N(t,function(t,o,i){r.push(e.call(n,t,o,i))}),r)};var k="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(t,e,n,r){var o=arguments.length>2;if(null==t&&(t=[]),g&&t.reduce===g)return r&&(e=T.bind(e,r)),o?t.reduce(e,n):t.reduce(e);if(N(t,function(t,i,s){o?n=e.call(r,n,t,i,s):(n=t,o=!0)}),!o)throw new TypeError(k);return n},T.reduceRight=T.foldr=function(t,e,n,r){var o=arguments.length>2;if(null==t&&(t=[]),y&&t.reduceRight===y)return r&&(e=T.bind(e,r)),o?t.reduceRight(e,n):t.reduceRight(e);var i=t.length;if(i!==+i){var s=T.keys(t);i=s.length}if(N(t,function(a,c,u){c=s?s[--i]:--i,o?n=e.call(r,n,t[c],c,u):(n=t[c],o=!0)}),!o)throw new TypeError(k);return n},T.find=T.detect=function(t,e,n){var r;return S(t,function(t,o,i){return e.call(n,t,o,i)?(r=t,!0):void 0}),r},T.filter=T.select=function(t,e,n){var r=[];return null==t?r:m&&t.filter===m?t.filter(e,n):(N(t,function(t,o,i){e.call(n,t,o,i)&&r.push(t)}),r)},T.reject=function(t,e,n){return T.filter(t,function(t,r,o){return!e.call(n,t,r,o)},n)},T.every=T.all=function(t,e,n){e||(e=T.identity);var r=!0;return null==t?r:v&&t.every===v?t.every(e,n):(N(t,function(t,i,s){return(r=r&&e.call(n,t,i,s))?void 0:o}),!!r)};var S=T.some=T.any=function(t,e,n){e||(e=T.identity);var r=!1;return null==t?r:b&&t.some===b?t.some(e,n):(N(t,function(t,i,s){return r||(r=e.call(n,t,i,s))?o:void 0}),!!r)};T.contains=T.include=function(t,e){return null==t?!1:w&&t.indexOf===w?-1!=t.indexOf(e):S(t,function(t){return t===e})},T.invoke=function(t,e){var n=u.call(arguments,2),r=T.isFunction(e);return T.map(t,function(t){return(r?e:t[e]).apply(t,n)})},T.pluck=function(t,e){return T.map(t,function(t){return t[e]})},T.where=function(t,e,n){return T.isEmpty(e)?n?void 0:[]:T[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},T.findWhere=function(t,e){return T.where(t,e,!0)},T.max=function(t,e,n){if(!e&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&T.isEmpty(t))return-1/0;var r={computed:-1/0,value:-1/0};return N(t,function(t,o,i){var s=e?e.call(n,t,o,i):t;s>r.computed&&(r={value:t,computed:s})}),r.value},T.min=function(t,e,n){if(!e&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&T.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return N(t,function(t,o,i){var s=e?e.call(n,t,o,i):t;s<r.computed&&(r={value:t,computed:s})}),r.value},T.shuffle=function(t){var e,n=0,r=[];return N(t,function(t){e=T.random(n++),r[n-1]=r[e],r[e]=t}),r},T.sample=function(t,e,n){return arguments.length<2||n?t[T.random(t.length-1)]:T.shuffle(t).slice(0,Math.max(0,e))};var A=function(t){return T.isFunction(t)?t:function(e){return e[t]}};T.sortBy=function(t,e,n){var r=A(e);return T.pluck(T.map(t,function(t,e,o){return{value:t,index:e,criteria:r.call(n,t,e,o)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return t.index-e.index}),"value")};var V=function(t){return function(e,n,r){var o={},i=null==n?T.identity:A(n);return N(e,function(n,s){var a=i.call(r,n,s,e);t(o,a,n)}),o}};T.groupBy=V(function(t,e,n){(T.has(t,e)?t[e]:t[e]=[]).push(n)}),T.indexBy=V(function(t,e,n){t[e]=n}),T.countBy=V(function(t,e){T.has(t,e)?t[e]++:t[e]=1}),T.sortedIndex=function(t,e,n,r){n=null==n?T.identity:A(n);for(var o=n.call(r,e),i=0,s=t.length;s>i;){var a=i+s>>>1;n.call(r,t[a])<o?i=a+1:s=a}return i},T.toArray=function(t){return t?T.isArray(t)?u.call(t):t.length===+t.length?T.map(t,T.identity):T.values(t):[]},T.size=function(t){return null==t?0:t.length===+t.length?t.length:T.keys(t).length},T.first=T.head=T.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:u.call(t,0,e)},T.initial=function(t,e,n){return u.call(t,0,t.length-(null==e||n?1:e))},T.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:u.call(t,Math.max(t.length-e,0))},T.rest=T.tail=T.drop=function(t,e,n){return u.call(t,null==e||n?1:e)},T.compact=function(t){return T.filter(t,T.identity)};var E=function(t,e,n){return e&&T.every(t,T.isArray)?l.apply(n,t):(N(t,function(t){T.isArray(t)||T.isArguments(t)?e?c.apply(n,t):E(t,e,n):n.push(t)}),n)};T.flatten=function(t,e){return E(t,e,[])},T.without=function(t){return T.difference(t,u.call(arguments,1))},T.uniq=T.unique=function(t,e,n,r){T.isFunction(e)&&(r=n,n=e,e=!1);var o=n?T.map(t,n,r):t,i=[],s=[];return N(o,function(n,r){(e?r&&s[s.length-1]===n:T.contains(s,n))||(s.push(n),i.push(t[r]))}),i},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=function(t){var e=u.call(arguments,1);return T.filter(T.uniq(t),function(t){return T.every(e,function(e){return T.indexOf(e,t)>=0})})},T.difference=function(t){var e=l.apply(i,u.call(arguments,1));return T.filter(t,function(t){return!T.contains(e,t)})},T.zip=function(){for(var t=T.max(T.pluck(arguments,"length").concat(0)),e=new Array(t),n=0;t>n;n++)e[n]=T.pluck(arguments,""+n);return e},T.object=function(t,e){if(null==t)return{};for(var n={},r=0,o=t.length;o>r;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},T.indexOf=function(t,e,n){if(null==t)return-1;var r=0,o=t.length;if(n){if("number"!=typeof n)return r=T.sortedIndex(t,e),t[r]===e?r:-1;r=0>n?Math.max(0,o+n):n}if(w&&t.indexOf===w)return t.indexOf(e,n);for(;o>r;r++)if(t[r]===e)return r;return-1},T.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=null!=n;if(_&&t.lastIndexOf===_)return r?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var o=r?n:t.length;o--;)if(t[o]===e)return o;return-1},T.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),o=0,i=new Array(r);r>o;)i[o++]=t,t+=n;return i};var j=function(){};T.bind=function(t,e){var n,r;if(P&&t.bind===P)return P.apply(t,u.call(arguments,1));if(!T.isFunction(t))throw new TypeError;return n=u.call(arguments,2),r=function(){if(!(this instanceof r))return t.apply(e,n.concat(u.call(arguments)));j.prototype=t.prototype;var o=new j;j.prototype=null;var i=t.apply(o,n.concat(u.call(arguments)));return Object(i)===i?i:o}},T.partial=function(t){var e=u.call(arguments,1);return function(){return t.apply(this,e.concat(u.call(arguments)))}},T.bindAll=function(t){var e=u.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return N(e,function(e){t[e]=T.bind(t[e],t)}),t},T.memoize=function(t,e){var n={};return e||(e=T.identity),function(){var r=e.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},T.delay=function(t,e){var n=u.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},T.defer=function(t){return T.delay.apply(T,[t,1].concat(u.call(arguments,1)))},T.throttle=function(t,e,n){var r,o,i,s=null,a=0;n||(n={});var c=function(){a=n.leading===!1?0:new Date,s=null,i=t.apply(r,o)};return function(){var u=new Date;a||n.leading!==!1||(a=u);var l=e-(u-a);return r=this,o=arguments,0>=l?(clearTimeout(s),s=null,a=u,i=t.apply(r,o)):s||n.trailing===!1||(s=setTimeout(c,l)),i}},T.debounce=function(t,e,n){var r,o,i,s,a;return function(){i=this,o=arguments,s=new Date;var c=function(){var u=new Date-s;e>u?r=setTimeout(c,e-u):(r=null,n||(a=t.apply(i,o)))},u=n&&!r;return r||(r=setTimeout(c,e)),u&&(a=t.apply(i,o)),a}},T.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},T.wrap=function(t,e){return function(){var n=[t];return c.apply(n,arguments),e.apply(this,n)}},T.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},T.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},T.keys=C||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)T.has(t,n)&&e.push(n);return e},T.values=function(t){for(var e=T.keys(t),n=e.length,r=new Array(n),o=0;n>o;o++)r[o]=t[e[o]];return r},T.pairs=function(t){for(var e=T.keys(t),n=e.length,r=new Array(n),o=0;n>o;o++)r[o]=[e[o],t[e[o]]];return r},T.invert=function(t){for(var e={},n=T.keys(t),r=0,o=n.length;o>r;r++)e[t[n[r]]]=n[r];return e},T.functions=T.methods=function(t){var e=[];for(var n in t)T.isFunction(t[n])&&e.push(n);return e.sort()},T.extend=function(t){return N(u.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},T.pick=function(t){var e={},n=l.apply(i,u.call(arguments,1));return N(n,function(n){n in t&&(e[n]=t[n])}),e},T.omit=function(t){var e={},n=l.apply(i,u.call(arguments,1));for(var r in t)T.contains(n,r)||(e[r]=t[r]);return e},T.defaults=function(t){return N(u.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},T.clone=function(t){return T.isObject(t)?T.isArray(t)?t.slice():T.extend({},t):t},T.tap=function(t,e){return e(t),t};var $=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof T&&(t=t._wrapped),e instanceof T&&(e=e._wrapped);var o=p.call(t);if(o!=p.call(e))return!1;switch(o){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var i=n.length;i--;)if(n[i]==t)return r[i]==e;var s=t.constructor,a=e.constructor;if(s!==a&&!(T.isFunction(s)&&s instanceof s&&T.isFunction(a)&&a instanceof a))return!1;n.push(t),r.push(e);var c=0,u=!0;if("[object Array]"==o){if(c=t.length,u=c==e.length)for(;c--&&(u=$(t[c],e[c],n,r)););}else{for(var l in t)if(T.has(t,l)&&(c++,!(u=T.has(e,l)&&$(t[l],e[l],n,r))))break;if(u){for(l in e)if(T.has(e,l)&&!c--)break;u=!c}}return n.pop(),r.pop(),u};T.isEqual=function(t,e){return $(t,e,[],[])},T.isEmpty=function(t){if(null==t)return!0;if(T.isArray(t)||T.isString(t))return 0===t.length;for(var e in t)if(T.has(t,e))return!1;return!0},T.isElement=function(t){return!(!t||1!==t.nodeType)},T.isArray=x||function(t){return"[object Array]"==p.call(t)},T.isObject=function(t){return t===Object(t)},N(["Arguments","Function","String","Number","Date","RegExp"],function(t){T["is"+t]=function(e){return p.call(e)=="[object "+t+"]"}}),T.isArguments(arguments)||(T.isArguments=function(t){return!(!t||!T.has(t,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(t){return"function"==typeof t}),T.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},T.isNaN=function(t){return T.isNumber(t)&&t!=+t},T.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==p.call(t)},T.isNull=function(t){return null===t},T.isUndefined=function(t){return void 0===t},T.has=function(t,e){return h.call(t,e)},T.noConflict=function(){return t._=r,this},T.identity=function(t){return t},T.times=function(t,e,n){for(var r=Array(Math.max(0,t)),o=0;t>o;o++)r[o]=e.call(n,o);return r},T.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};I.unescape=T.invert(I.escape);var R={escape:new RegExp("["+T.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(I.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(t){T[t]=function(e){return null==e?"":(""+e).replace(R[t],function(e){return I[t][e]})}}),T.result=function(t,e){if(null==t)return void 0;var n=t[e];return T.isFunction(n)?n.call(t):n},T.mixin=function(t){N(T.functions(t),function(e){var n=T[e]=t[e];T.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),L.call(this,n.apply(T,t))}})};var M=0;T.uniqueId=function(t){var e=++M+"";return t?t+e:e},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(t,e,n){var r;n=T.defaults({},n,T.templateSettings);var o=new RegExp([(n.escape||q).source,(n.interpolate||q).source,(n.evaluate||q).source].join("|")+"|$","g"),i=0,s="__p+='";t.replace(o,function(e,n,r,o,a){return s+=t.slice(i,a).replace(D,function(t){return"\\"+O[t]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=a+e.length,e}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(e)return r(e,T);var c=function(t){return r.call(this,t,T)};return c.source="function("+(n.variable||"obj")+"){\n"+s+"}",c},T.chain=function(t){return T(t).chain()};var L=function(t){return this._chain?T(t).chain():t};T.mixin(T),N(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];T.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],L.call(this,n)}}),N(["concat","join","slice"],function(t){var e=i[t];T.prototype[t]=function(){return L.call(this,e.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],176:[function(t,e){"use strict";var n=t("lens"),r=n.getDefaultPanels(),o=t("lens-converter"),i=t("lens-converter/elife_converter"),s=function(t){n.call(this,t)};s.Prototype=function(){this.getConverters=function(t){return[new i(t),new o(t)]},this.getPanels=function(){return r.slice(0)}},s.Prototype.prototype=n.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,e.exports=s},{lens:122,"lens-converter":120,"lens-converter/elife_converter":119}],177:[function(){},{}]},{},[1]);